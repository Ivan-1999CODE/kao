<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‹±æ–‡å–®å­—å†’éšª (Unit 1 & 2) - æ–‡æ³•æ“´å……ç‰ˆ</title>
    
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- ä¿®æ­£ Babel è¨­å®šï¼šæŒ‡å®šç‰ˆæœ¬ä¸¦åœ¨ä¸‹æ–¹ script æ¨™ç±¤åŠ å…¥ presets -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.6/babel.min.js"></script>

    <!-- Import Map -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.292.0"
        }
    }
    </script>
    
    <style>
        /* é¿å…è¼‰å…¥æ™‚é–ƒçˆ */
        body { opacity: 0; transition: opacity 0.5s; }
        body.loaded { opacity: 1; }
        
        /* é‡å° iOS Safari çš„ä¸€äº›å„ªåŒ– */
        * { -webkit-tap-highlight-color: transparent; }
        
        /* è‡ªå®šç¾©æ²è»¸æ¨£å¼ */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9; 
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }
        
        /* æ‹¼å­—å‹•ç•« */
        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .pop-in {
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }
    </style>
</head>
<body class="bg-sky-50">
    <div id="root"></div>

    <!-- é€™è£¡é–‹å§‹æ˜¯ React ç¨‹å¼ç¢¼ -->
    <!-- ä¿®æ­£ï¼šåŠ å…¥ data-presets="react" ä»¥é¿å… targets è¨­å®šéŒ¯èª¤ -->
    <script type="text/babel" data-type="module" data-presets="react">
        import React, { useState, useEffect, useRef } from 'react';
        import ReactDOM from 'react-dom/client';
        import { 
            BookOpen, Gamepad2, LayoutList, Layers, Volume2, ChevronLeft, ChevronRight, 
            CheckCircle, XCircle, Trophy, Star, Sparkles, HelpCircle, RefreshCw, Library, 
            Puzzle, Lightbulb, Music, Map, Wand2, Flag, AlertCircle, ArrowDownLeft, 
            Shuffle, GraduationCap, PenTool, Coffee, Keyboard, MousePointerClick, Filter, Eye, Timer, Home, Info,
            FileText, X 
        } from 'lucide-react';

        // --- èªéŸ³èˆ‡éŸ³æ•ˆåˆæˆå„ªåŒ– ---
        let availableVoices = [];
        
        const loadVoices = () => {
            if (!window.speechSynthesis) return;
            const voices = window.speechSynthesis.getVoices();
            if (voices.length > 0) {
                availableVoices = voices;
            }
        };

        loadVoices();
        if (window.speechSynthesis && window.speechSynthesis.onvoiceschanged !== undefined) {
            window.speechSynthesis.onvoiceschanged = loadVoices;
        }

        const speakText = (text) => {
            if (!window.speechSynthesis) return;
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            let selectedVoice = availableVoices.find(v => 
                (v.lang === 'en-US' || v.lang === 'en_US') && !v.name.includes("Network")
            );
            if (!selectedVoice) {
                selectedVoice = availableVoices.find(v => v.lang.includes('en'));
            }
            if (selectedVoice) {
                utterance.voice = selectedVoice;
            }
            utterance.lang = 'en-US'; 
            utterance.rate = 0.9;
            utterance.pitch = 1;
            window.speechSynthesis.speak(utterance);
        };

        // ç°¡å–®çš„éŸ³æ•ˆç”¢ç”Ÿå™¨ (Web Audio API)
        const playSound = (type) => {
            try {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                if (!AudioContext) return;
                
                const ctx = new AudioContext();
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                
                osc.connect(gain);
                gain.connect(ctx.destination);
                
                if (type === 'correct') {
                    // å®å’šè² (é«˜éŸ³)
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(500, ctx.currentTime);
                    osc.frequency.exponentialRampToValueAtTime(1000, ctx.currentTime + 0.1);
                    gain.gain.setValueAtTime(0.1, ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
                    osc.start();
                    osc.stop(ctx.currentTime + 0.5);
                } else {
                    // éŒ¯èª¤è² (ä½éŸ³é‹¸é½’æ³¢)
                    osc.type = 'sawtooth';
                    osc.frequency.setValueAtTime(150, ctx.currentTime);
                    osc.frequency.linearRampToValueAtTime(100, ctx.currentTime + 0.3);
                    gain.gain.setValueAtTime(0.1, ctx.currentTime);
                    gain.gain.linearRampToValueAtTime(0.01, ctx.currentTime + 0.3);
                    osc.start();
                    osc.stop(ctx.currentTime + 0.3);
                }
            } catch (e) {
                console.error("Audio play failed", e);
            }
        };

        // --- å·¥å…·å‡½å¼ ---
        const shuffleArray = (array) => {
            if (!array) return [];
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        };

        // --- Unit 1 æ–‡æ³•é¡Œåº«ç”Ÿæˆ (åŸ Unit 5: æˆèˆ‡å‹•è© & Not only but also) ---
        const generateUnit1QuizPool = () => {
            const pool = [
                // Part 1: è™›ä¸»è© It çš„ç”¨æ³• (25é¡Œ)
                { q: "______ is important to wash your hands before meals.", options: ["That", "This", "It"], ans: "It", hint: "è™›ä¸»è©å›ºå®šç”¨ It" },
                { q: "It is difficult ______ many new words in one day.", options: ["memorize", "to memorize", "memorizing"], ans: "to memorize", hint: "It is + adj + to V (ä¸å®šè©ç•¶çœŸä¸»è©)" },
                { q: "Is ______ necessary for us to bring an umbrella today?", options: ["it", "that", "there"], ans: "it", hint: "è™›ä¸»è©å¥å‹ç–‘å•å¥ Is it...?" },
                { q: "It ______ exciting to watch the baseball game last night.", options: ["is", "was", "are"], ans: "was", hint: "last night (æ˜¨æ™š) ç”¨éå»å¼ was" },
                { q: "It's not easy ______ a foreign language well.", options: ["speak", "spoke", "to speak"], ans: "to speak", hint: "It is + adj + to V" },
                { q: "It is fun ______ kites in the park on windy days.", options: ["to fly", "fly", "flies"], ans: "to fly", hint: "It is + adj + to V" },
                { q: "______ is wrong to copy your classmate's homework.", options: ["This", "That", "It"], ans: "It", hint: "è™›ä¸»è©å›ºå®šç”¨ It" },
                { q: "It is dangerous for children ______ alone in the river.", options: ["swim", "to swim", "swimming"], ans: "to swim", hint: "It is + adj + (for äºº) + to V" },
                { q: "Was it hard ______ the math problem yesterday?", options: ["solve", "to solve", "solved"], ans: "to solve", hint: "ä¸å®šè© to V ç•¶çœŸä¸»è©" },
                { q: "It is polite ______ \"Thank you\" when people help you.", options: ["to say", "say", "saying"], ans: "to say", hint: "It is + adj + to V" },
                { q: "It's great ______ a picnic with friends on weekends.", options: ["have", "to have", "had"], ans: "to have", hint: "It is + adj + to V" },
                { q: "Is it possible ______ a train to Taipei in ten minutes?", options: ["catch", "to catch", "catching"], ans: "to catch", hint: "It is + adj + to V" },
                { q: "It ______ lucky for her to find her lost wallet.", options: ["was", "be", "were"], ans: "was", hint: "äº‹ä»¶å·²ç™¼ç”Ÿ(æ‰¾åˆ°çš®å¤¾)ï¼Œç”¨éå»å¼" },
                { q: "It is healthy ______ more vegetables and less junk food.", options: ["eat", "to eat", "ate"], ans: "to eat", hint: "It is + adj + to V" },
                { q: "It is convenient ______ the bus to the night market.", options: ["take", "to take", "taking"], ans: "to take", hint: "It is + adj + to V" },
                { q: "It is cool ______ a robot to help with housework.", options: ["to have", "has", "having"], ans: "to have", hint: "It is + adj + to V" },
                { q: "______ is very kind of you to help the old lady.", options: ["This", "It", "That"], ans: "It", hint: "è™›ä¸»è©å›ºå®šç”¨ It" },
                { q: "It is important for us ______ our environment.", options: ["protect", "to protect", "protected"], ans: "to protect", hint: "It is + adj + for äºº + to V" },
                { q: "Was ______ boring to wait for the bus for an hour?", options: ["it", "this", "that"], ans: "it", hint: "è™›ä¸»è©å›ºå®šç”¨ It" },
                { q: "It's not good ______ too many computer games.", options: ["play", "to play", "played"], ans: "to play", hint: "It is + adj + to V" },
                { q: "It is expensive ______ a new smartphone these days.", options: ["to buy", "buy", "buying"], ans: "to buy", hint: "It is + adj + to V" },
                { q: "It is useful ______ English when you travel abroad.", options: ["speak", "spoke", "to speak"], ans: "to speak", hint: "It is + adj + to V" },
                { q: "It's necessary ______ medicine on time.", options: ["to take", "take", "taking"], ans: "to take", hint: "It is + adj + to V" },
                { q: "It is interesting ______ about different cultures.", options: ["learn", "to learn", "learning"], ans: "to learn", hint: "It is + adj + to V" },
                { q: "______ is a good experience to work as a volunteer.", options: ["It", "This", "That"], ans: "It", hint: "è™›ä¸»è©å›ºå®šç”¨ It" },

                // Part 2: å½¢å®¹è©èˆ‡å‰¯è©çš„æ¯”è¼ƒç´š (25é¡Œ)
                { q: "My brother is ______ than I am.", options: ["tall", "taller", "more tall"], ans: "taller", hint: "å–®éŸ³ç¯€å½¢å®¹è©æ¯”è¼ƒç´šåŠ  er" },
                { q: "This blue dress looks ______ than that red one.", options: ["prettier", "more pretty", "pretty"], ans: "prettier", hint: "å­—å°¾ y å» y æ”¹ ier" },
                { q: "The weather today is even ______ than it was yesterday.", options: ["bad", "badder", "worse"], ans: "worse", hint: "bad çš„æ¯”è¼ƒç´šæ˜¯ä¸è¦å‰‡è®ŠåŒ– worse" },
                { q: "Learning English is ______ than I thought.", options: ["easier", "more easy", "easyer"], ans: "easier", hint: "easy -> easier" },
                { q: "Sandy sings ______ than anyone else in her class.", options: ["beautiful", "more beautifully", "beautifully"], ans: "more beautifully", hint: "ä¿®é£¾å‹•ä½œ sings ç”¨å‰¯è©ï¼Œå¤šéŸ³ç¯€åŠ  more" },
                { q: "A car is ______ than a bicycle.", options: ["expensive", "more expensive", "expensiver"], ans: "more expensive", hint: "å¤šéŸ³ç¯€å½¢å®¹è©å‰åŠ  more" },
                { q: "My father drives ______ than my mother.", options: ["carefully", "more carefully", "more careful"], ans: "more carefully", hint: "ä¿®é£¾å‹•ä½œ drives ç”¨å‰¯è© carefully" },
                { q: "The MRT is ______ than the bus in Taipei.", options: ["convenienter", "more convenient", "convenient"], ans: "more convenient", hint: "å¤šéŸ³ç¯€å½¢å®¹è©å‰åŠ  more" },
                { q: "This box is ______ than that one. Can you help me?", options: ["heavyer", "heavier", "more heavy"], ans: "heavier", hint: "heavy -> heavier" },
                { q: "The students are working ______ than before for the exam.", options: ["harder", "more hard", "more hardly"], ans: "harder", hint: "hard çš„å‰¯è©é‚„æ˜¯ hardï¼Œæ¯”è¼ƒç´šåŠ  er" },
                { q: "My grandmother walks ______ than I do.", options: ["slowly", "more slow", "more slowly"], ans: "more slowly", hint: "å‰¯è© slowly æ¯”è¼ƒç´šç”¨ more slowly" },
                { q: "The elephant is ______ than the tiger.", options: ["big", "bigger", "more big"], ans: "bigger", hint: "çŸ­æ¯éŸ³å–®å­—é‡è¤‡å­—å°¾åŠ  er" },
                { q: "Your cake tastes ______ than the one from the bakery.", options: ["good", "better", "well"], ans: "better", hint: "good çš„æ¯”è¼ƒç´šæ˜¯ä¸è¦å‰‡è®ŠåŒ– better" },
                { q: "It is ______ today than it was last week.", options: ["hotter", "hoter", "more hot"], ans: "hotter", hint: "hot é‡è¤‡å­—å°¾ t åŠ  er" },
                { q: "Watching movies is ______ than reading books to me.", options: ["interesting", "more interesting", "attractiver"], ans: "more interesting", hint: "å¤šéŸ³ç¯€å½¢å®¹è©å‰åŠ  more" },
                { q: "Kevin speaks English ______ than his sister.", options: ["fluently", "more fluently", "more fluent"], ans: "more fluently", hint: "ä¿®é£¾ speaks ç”¨å‰¯è©ï¼Œæ¯”è¼ƒç´šåŠ  more" },
                { q: "This smartphone is ______ than that old model.", options: ["more thin", "thinner", "thinier"], ans: "thinner", hint: "thin é‡è¤‡å­—å°¾ n åŠ  er" },
                { q: "The science test was ______ than the history test.", options: ["more difficult", "difficulter", "difficult"], ans: "more difficult", hint: "å¤šéŸ³ç¯€å½¢å®¹è©å‰åŠ  more" },
                { q: "You should study ______ if you want to get good grades.", options: ["diligent", "more diligently", "more diligent"], ans: "more diligently", hint: "ä¿®é£¾ study ç”¨å‰¯è© diligently" },
                { q: "The little boy cried ______ than his sister.", options: ["loudly", "louder", "more loud"], ans: "louder", hint: "loud/loudly çš„æ¯”è¼ƒç´šçš†å¯ç”¨ louder" },
                { q: "Apples are ______ than candy for your teeth.", options: ["healthyer", "more healthy", "healthier"], ans: "healthier", hint: "healthy -> healthier" },
                { q: "A plane flies ______ than a bird.", options: ["fast", "faster", "more fast"], ans: "faster", hint: "fast çš„æ¯”è¼ƒç´šåŠ  er" },
                { q: "My room is ______ than yours.", options: ["dirtier", "more dirty", "dirtyer"], ans: "dirtier", hint: "dirty -> dirtier" },
                { q: "Doing exercise makes you ______ than sitting all day.", options: ["stronger", "more strong", "strongier"], ans: "stronger", hint: "strong -> stronger" },
                { q: "This story is ______ than the one you told me.", options: ["funnyer", "funnier", "more funny"], ans: "funnier", hint: "funny -> funnier" }
            ];
            return shuffleArray(pool);
        };

        // --- Unit 1 æ–‡æ³•é‡çµ„å¥å­ (åŸ Unit 5) ---
        const generateUnit1GrammarScramble = () => {
            const sentences = [
                // è™›ä¸»è© It
                { s: "It is important to wash your hands.", ch: "æ´—æ‰‹æ˜¯å¾ˆé‡è¦çš„ã€‚(It is...)" },
                { s: "It is polite to say thank you.", ch: "èªªè¬è¬æ˜¯æœ‰ç¦®è²Œçš„ã€‚" },
                { s: "It is convenient to take the bus.", ch: "æ­å…¬è»Šå¾ˆæ–¹ä¾¿ã€‚" },
                { s: "It is dangerous to swim alone.", ch: "ç¨è‡ªæ¸¸æ³³å¾ˆå±éšªã€‚" },
                { s: "It is exciting to watch the game.", ch: "çœ‹æ¯”è³½å¾ˆåˆºæ¿€ã€‚" },
                
                // æ¯”è¼ƒç´š
                { s: "My brother is taller than I am.", ch: "æˆ‘å“¥å“¥æ¯”æˆ‘é«˜ã€‚" },
                { s: "The weather today is worse than yesterday.", ch: "ä»Šå¤©çš„å¤©æ°£æ¯”æ˜¨å¤©å·®ã€‚" },
                { s: "Sandy sings more beautifully than anyone.", ch: "Sandy å”±å¾—æ¯”ä»»ä½•äººéƒ½å¥½è½ã€‚" },
                { s: "The MRT is more convenient than the bus.", ch: "æ·é‹æ¯”å…¬è»Šæ–¹ä¾¿ã€‚" },
                { s: "This smartphone is thinner than that one.", ch: "é€™æ”¯æ™ºæ…§å‹æ‰‹æ©Ÿæ¯”é‚£ä¸€æ”¯è–„ã€‚" },
                { s: "A plane flies faster than a bird.", ch: "é£›æ©Ÿé£›å¾—æ¯”é³¥å¿«ã€‚" }
            ];
            return sentences.map((item, index) => ({
                id: `u1-grammar-sc-${index}`,
                sentence: item.s,
                sentence_ch: item.ch
            }));
        };

        // --- Unit 2 æ–‡æ³•é¡Œåº«ç”Ÿæˆ (åŸ Unit 6: åè©å­å¥ & æ„Ÿå®˜å‹•è©) ---
        const generateUnit2QuizPool = () => {
            const pool = [
                // Part 1: åè©å­å¥ (that å­å¥)
                { q: "I believe ________ we can save the Earth if we recycle more garbage.", options: ["that", "what", "who"], ans: "that", hint: "believe + that å­å¥ç•¶å—è©" },
                { q: "Our teacher explained ________ the moon goes around the Earth.", options: ["which", "that", "how"], ans: "that", hint: "explain + that å­å¥ (è§£é‡‹ä¸€ä»¶äº‹å¯¦)" },
                { q: "Jenny said ________ she would come to the party tonight.", options: ["this", "who", "that"], ans: "that", hint: "say + that å­å¥" },
                { q: "Most people know ________ exercise is good for their health.", options: ["if", "that", "which"], ans: "that", hint: "know + that å­å¥ (çŸ¥é“ä¸€ä»¶äº‹)" },
                { q: "We hope ________ the weather will be fine tomorrow for our picnic.", options: ["that", "where", "when"], ans: "that", hint: "hope + that å­å¥" },
                { q: "Jack realized ________ he had left his wallet at home.", options: ["that", "who", "what"], ans: "that", hint: "realize + that å­å¥" },
                { q: "Do you think ________ it is possible to finish the work in one day?", options: ["that", "which", "who"], ans: "that", hint: "think + that å­å¥" },
                { q: "The news reported ________ many people lost their homes in the earthquake.", options: ["who", "that", "what"], ans: "that", hint: "report + that å­å¥" },
                { q: "I am sure ________ your hard work will lead to success.", options: ["which", "that", "where"], ans: "that", hint: "be sure + that å­å¥" },
                { q: "My parents feel ________ I should spend more time on my studies.", options: ["that", "who", "what"], ans: "that", hint: "feel + that å­å¥" },
                { q: "He told me ________ he had already seen that movie twice.", options: ["who", "which", "that"], ans: "that", hint: "tell sb + that å­å¥" },
                { q: "Scientists found ________ the temperature of the planet is rising.", options: ["that", "where", "who"], ans: "that", hint: "found (ç™¼ç¾) + that å­å¥" },
                { q: "Mom thinks ________ the food in that restaurant is too expensive.", options: ["which", "that", "what"], ans: "that", hint: "think + that å­å¥" },
                { q: "Do you understand ________ time is more important than money?", options: ["who", "where", "that"], ans: "that", hint: "understand + that å­å¥" },
                { q: "I noticed ________ some students were sleeping in the class.", options: ["that", "which", "what"], ans: "that", hint: "notice + that å­å¥" },
                { q: "They hope ________ the new law can help the environment.", options: ["who", "that", "which"], ans: "that", hint: "hope + that å­å¥" },
                { q: "I heard ________ our English teacher is going to get married.", options: ["that", "what", "where"], ans: "that", hint: "hear + that å­å¥ (è½èªª)" },
                { q: "Everyone agrees ________ we should be polite to others.", options: ["which", "who", "that"], ans: "that", hint: "agree + that å­å¥" },
                { q: "Did you know ________ there are many different cultures in the world?", options: ["that", "what", "which"], ans: "that", hint: "know + that å­å¥" },
                { q: "I hope ________ my dream will come true some day.", options: ["which", "that", "who"], ans: "that", hint: "hope + that å­å¥" },
                { q: "The boss said ________ the meeting would start at nine.", options: ["that", "who", "what"], ans: "that", hint: "say + that å­å¥" },
                { q: "We believe ________ education can change a person's life.", options: ["which", "that", "where"], ans: "that", hint: "believe + that å­å¥" },
                { q: "He realized ________ he was wrong about the answer.", options: ["who", "what", "that"], ans: "that", hint: "realize + that å­å¥" },
                { q: "My sister thinks ________ learning English is fun.", options: ["that", "which", "who"], ans: "that", hint: "think + that å­å¥" },
                { q: "I hope ________ Nancy will like the gift I bought for her.", options: ["what", "that", "which"], ans: "that", hint: "hope + that å­å¥" },

                // Part 2: æ„Ÿå®˜å‹•è© (see, hear, watch, etc.)
                { q: "I saw a little girl ________ a flower in the garden.", options: ["to pick", "picking", "picks"], ans: "picking", hint: "see + O + V-ing (çœ‹è¦‹æ­£åœ¨åš)" },
                { q: "Did you hear the phone ________ just now?", options: ["ring", "to ring", "rang"], ans: "ring", hint: "hear + O + VR (è½è¦‹éŸ¿äº†)" },
                { q: "We watched the sun ________ over the sea.", options: ["to rise", "rising", "rises"], ans: "rising", hint: "watch + O + V-ing (è§€çœ‹æ­£åœ¨ä¸Šå‡)" },
                { q: "I felt something ________ on my arm.", options: ["to crawl", "crawling", "crawls"], ans: "crawling", hint: "feel + O + V-ing (æ„Ÿè¦ºæ­£åœ¨çˆ¬)" },
                { q: "Mom listened to the birds ________ in the trees.", options: ["singing", "to sing", "sang"], ans: "singing", hint: "listen to + O + V-ing (è½è¦‹æ­£åœ¨å”±)" },
                { q: "He noticed a stranger ________ into the building.", options: ["to enter", "enter", "enters"], ans: "enter", hint: "notice + O + VR (æ³¨æ„åˆ°é€²å…¥çš„äº‹å¯¦)" },
                { q: "Did you see Kevin ________ his homework in the library?", options: ["to do", "doing", "does"], ans: "doing", hint: "see + O + V-ing (çœ‹è¦‹æ­£åœ¨åš)" },
                { q: "I heard my brother ________ in the bathroom.", options: ["to cry", "cry", "cries"], ans: "cry", hint: "hear + O + VR (è½è¦‹å“­äº†)" },
                { q: "We saw the airplane ________ across the sky.", options: ["flying", "to fly", "flies"], ans: "flying", hint: "see + O + V-ing (çœ‹è¦‹æ­£åœ¨é£›)" },
                { q: "The teacher watched the students ________ the game.", options: ["to play", "playing", "played"], ans: "playing", hint: "watch + O + V-ing (è§€çœ‹æ­£åœ¨ç©)" },
                { q: "I felt the house ________ during the earthquake.", options: ["shake", "to shake", "shook"], ans: "shake", hint: "feel + O + VR (æ„Ÿè¦ºæ–æ™ƒ)" },
                { q: "Did anyone hear the baby ________ upstairs?", options: ["to cry", "crying", "cries"], ans: "crying", hint: "hear + O + V-ing (è½è¦‹æ­£åœ¨å“­)" },
                { q: "I saw him ________ the street carefully.", options: ["cross", "to cross", "crossed"], ans: "cross", hint: "see + O + VR (çœ‹è¦‹éé¦¬è·¯çš„å…¨ç¨‹)" },
                { q: "Listen to the rain ________ against the window.", options: ["hitting", "to hit", "hits"], ans: "hitting", hint: "listen to + O + V-ing (è½è‘—é›¨æ‰“åœ¨çª—ä¸Š)" },
                { q: "We watched the magician ________ a rabbit out of the hat.", options: ["pull", "to pull", "pulled"], ans: "pull", hint: "watch + O + VR (è§€çœ‹è®Šå‡ºçš„éç¨‹)" },
                { q: "I noticed my father ________ a new tie today.", options: ["to wear", "wearing", "wears"], ans: "wearing", hint: "notice + O + V-ing (æ³¨æ„åˆ°æˆ´è‘—)" },
                { q: "Did you see the cat ________ down from the wall?", options: ["to jump", "jumping", "jumps"], ans: "jumping", hint: "see + O + V-ing (çœ‹è¦‹æ­£åœ¨è·³)" },
                { q: "I heard someone ________ my name outside.", options: ["to call", "call", "called"], ans: "call", hint: "hear + O + VR (è½è¦‹å«å–š)" },
                { q: "We felt the wind ________ colder and colder.", options: ["getting", "to get", "got"], ans: "getting", hint: "feel + O + V-ing (æ„Ÿè¦ºæ­£åœ¨è®Šå†·)" },
                { q: "She watched her brother ________ his bicycle.", options: ["fix", "to fix", "fixed"], ans: "fix", hint: "watch + O + VR (çœ‹è‘—ä¿®ç†)" },
                { q: "Did you notice the dog ________ after the ball?", options: ["to run", "running", "runs"], ans: "running", hint: "notice + O + V-ing (æ³¨æ„åˆ°æ­£åœ¨è·‘)" },
                { q: "I heard the door ________ loudly.", options: ["to close", "close", "closed"], ans: "close", hint: "hear + O + VR (è½è¦‹é—œé–€è²)" },
                { q: "We saw many people ________ in the park.", options: ["to dance", "dancing", "dances"], ans: "dancing", hint: "see + O + V-ing (çœ‹è¦‹æ­£åœ¨è·³èˆ)" },
                { q: "I watched him ________ the letter and then burn it.", options: ["read", "to read", "reading"], ans: "read", hint: "watch + O + VR (and then burn it æš—ç¤ºé€£çºŒå‹•ä½œï¼Œç”¨åŸå½¢)" },
                { q: "Can you feel your heart ________ fast?", options: ["beat", "to beat", "beats"], ans: "beat", hint: "feel + O + VR (æ„Ÿè¦ºè·³å‹•)" }
            ];
            return shuffleArray(pool);
        };

        // --- Unit 2 æ–‡æ³•é‡çµ„å¥å­ (åŸ Unit 6) ---
        const generateUnit2GrammarScramble = () => {
            const sentences = [
                // Noun Clauses
                { s: "I believe that we can save the Earth.", ch: "æˆ‘ç›¸ä¿¡æˆ‘å€‘å¯ä»¥æ‹¯æ•‘åœ°çƒã€‚" },
                { s: "Jenny said that she would come to the party.", ch: "Jenny èªªå¥¹æœƒä¾†åƒåŠ æ´¾å°ã€‚" },
                { s: "Most people know that exercise is good.", ch: "å¤§å¤šæ•¸äººçŸ¥é“é‹å‹•æ˜¯å¥½çš„ã€‚" },
                { s: "I hope that my dream will come true.", ch: "æˆ‘å¸Œæœ›æˆ‘çš„å¤¢æƒ³æœƒæˆçœŸã€‚" },
                
                // Sensory Verbs
                { s: "I saw a little girl picking a flower.", ch: "æˆ‘çœ‹è¦‹ä¸€å€‹å°å¥³å­©æ­£åœ¨æ‘˜èŠ±ã€‚" },
                { s: "We watched the sun rising over the sea.", ch: "æˆ‘å€‘çœ‹è‘—å¤ªé™½å¾æµ·é¢å‡èµ·ã€‚" },
                { s: "I heard someone call my name.", ch: "æˆ‘è½è¦‹æœ‰äººå«æˆ‘çš„åå­—ã€‚" },
                { s: "He noticed a stranger enter the building.", ch: "ä»–æ³¨æ„åˆ°ä¸€å€‹é™Œç”Ÿäººé€²å…¥å¤§æ¨“ã€‚" },
                { s: "I saw him cross the street carefully.", ch: "æˆ‘çœ‹è¦‹ä»–å°å¿ƒåœ°éé¦¬è·¯ã€‚" },
                { s: "Listen to the rain hitting against the window.", ch: "è½é‚£é›¨æ°´æ‰“åœ¨çª—æˆ¶ä¸Šçš„è²éŸ³ã€‚" }
            ];
            return sentences.map((item, index) => ({
                id: `u2-grammar-sc-${index}`,
                sentence: item.s,
                sentence_ch: item.ch
            }));
        };

        // --- Unit 1 å–®å­—è³‡æ–™ (Vocab Data) - æ›´æ–°ç‰ˆ ---
        const unit1VocabData = [
            { id: "u1-1", word: "attraction", part: "n.", chinese: "æœ‰å¸å¼•åŠ›çš„æ™¯é»ã€äº‹ç‰©", sentence: "Jiufen is a very popular tourist attraction in Taiwan.", sentence_ch: "ä¹ä»½æ˜¯å°ç£éå¸¸å—æ­¡è¿çš„è§€å…‰æ™¯é»ã€‚" },
            { id: "u1-2", word: "local", part: "adj.", chinese: "ç•¶åœ°çš„", sentence: "Our hotel is close to the local beach. We can walk there in three minutes.", sentence_ch: "æˆ‘å€‘çš„é£¯åº—é è¿‘ç•¶åœ°çš„æµ·ç˜ã€‚æˆ‘å€‘èµ°è·¯ä¸‰åˆ†é˜å°±èƒ½åˆ°ã€‚" },
            { id: "u1-3", word: "locals", part: "n.", chinese: "ç•¶åœ°å±…æ°‘", sentence: "When the earthquake hit this town, many of the locals were sleeping.", sentence_ch: "ç•¶åœ°éœ‡è¥²æ“Šé€™å€‹åŸé®æ™‚ï¼Œè¨±å¤šç•¶åœ°å±…æ°‘æ­£åœ¨ç¡è¦ºã€‚" },
            { id: "u1-4", word: "plain", part: "adj.", chinese: "æ¨¸ç´ çš„", sentence: "To everyoneâ€™s surprise, Lady Gaga wore a plain dress to the party.", sentence_ch: "ä»¤å¤§å®¶é©šè¨çš„æ˜¯ï¼ŒLady Gaga ç©¿äº†ä¸€ä»¶æ¨¸ç´ çš„æ´‹è£å»åƒåŠ æ´¾å°ã€‚" },
            { id: "u1-5", word: "counter", part: "n.", chinese: "æ«ƒè‡º", sentence: "A lot of people in the SOGO department store are waiting in front of the counter to get a free gift.", sentence_ch: "SOGO ç™¾è²¨å…¬å¸è£¡æœ‰å¾ˆå¤šäººåœ¨æ«ƒæª¯å‰æ’éšŠé ˜å–å…è²»è´ˆå“ã€‚" },
            { id: "u1-6", word: "hug", part: "v.", chinese: "æ“æŠ±", sentence: "The couple hug each other every time they meet.", sentence_ch: "é€™å°æƒ…ä¾¶æ¯æ¬¡è¦‹é¢éƒ½æœƒäº’ç›¸æ“æŠ±ã€‚" },
            { id: "u1-7", word: "pleased", part: "adj.", chinese: "é«˜èˆˆçš„ï¼Œæ»¿æ„çš„", sentence: "Ann was not pleased with her fries at the restaurant. They were cold.", sentence_ch: "Ann å°é¤å»³çš„è–¯æ¢ä¸æ»¿æ„ã€‚å®ƒå€‘æ˜¯å†·çš„ã€‚" },
            { id: "u1-8", word: "mood", part: "n.", chinese: "å¿ƒæƒ…ï¼Œæƒ…ç·’", sentence: "Justin is in a good mood because the long weekend is coming.", sentence_ch: "Justin å¿ƒæƒ…å¾ˆå¥½ï¼Œå› ç‚ºé•·é€±æœ«å¿«åˆ°äº†ã€‚" },
            { id: "u1-9", word: "unfairly", part: "adv.", chinese: "ä¸å…¬å¹³åœ°", sentence: "Daniel is angry about being treated unfairly by his boss.", sentence_ch: "Daniel å°è¢«è€é—†ä¸å…¬å¹³å°å¾…æ„Ÿåˆ°ç”Ÿæ°£ã€‚" },
            { id: "u1-10", word: "fair", part: "adj.", chinese: "å…¬å¹³çš„", sentence: "The rules of a game should be fair to all the players.", sentence_ch: "éŠæˆ²è¦å‰‡å°æ‰€æœ‰ç©å®¶éƒ½æ‡‰è©²æ˜¯å…¬å¹³çš„ã€‚" },
            { id: "u1-11", word: "observe", part: "v.", chinese: "è§€å¯Ÿ", sentence: "The clerk was bored, so he started to observe the people in the store.", sentence_ch: "åº—å“¡å¾ˆç„¡èŠï¼Œæ‰€ä»¥ä»–é–‹å§‹è§€å¯Ÿåº—è£¡çš„äººã€‚" },
            { id: "u1-12", word: "observation", part: "n.", chinese: "è§€å¯Ÿ", sentence: "The sick boy cannot go home. He needs to be kept under observation in the hospital.", sentence_ch: "ç”Ÿç—…çš„ç”·å­©ä¸èƒ½å›å®¶ã€‚ä»–éœ€è¦åœ¨é†«é™¢ç•™é™¢è§€å¯Ÿã€‚" },
            { id: "u1-13", word: "customer", part: "n.", chinese: "é¡§å®¢", sentence: "The shop serves customers till 5 p.m. every day.", sentence_ch: "é€™å®¶åº—æ¯å¤©æœå‹™é¡§å®¢åˆ°ä¸‹åˆäº”é»ã€‚" },
            { id: "u1-14", word: "seem", part: "v.", chinese: "å¥½åƒï¼Œä¼¼ä¹", sentence: "From his Facebook photo, Larry seems to have a new girlfriend.", sentence_ch: "å¾ä»–çš„è‡‰æ›¸ç…§ç‰‡çœ‹ä¾†ï¼ŒLarry ä¼¼ä¹æœ‰äº†æ–°å¥³æœ‹å‹ã€‚" },
            { id: "u1-15", word: "reveal", part: "v.", chinese: "æ­éœ²ï¼Œé€éœ²", sentence: "The news reveals that the convenience store will hold a special event.", sentence_ch: "æ–°èé€éœ²ä¾¿åˆ©å•†åº—å°‡èˆ‰è¾¦ç‰¹åˆ¥æ´»å‹•ã€‚" },
            { id: "u1-16", word: "secret", part: "n.", chinese: "ç§˜å¯†", sentence: "Helen is good at keeping secrets, so you won't hear anything from her.", sentence_ch: "Helen å¾ˆæœƒä¿å®ˆç§˜å¯†ï¼Œæ‰€ä»¥ä½ ä¸æœƒå¾å¥¹é‚£è£¡è½åˆ°ä»»ä½•äº‹ã€‚" },
            { id: "u1-17", word: "secret", part: "adj.", chinese: "ç§˜å¯†çš„", sentence: "In the movie, four kids found a secret gate to a magic land in their house.", sentence_ch: "é›»å½±ä¸­ï¼Œå››å€‹å­©å­åœ¨ä»–å€‘å®¶è£¡ç™¼ç¾äº†ä¸€é“é€šå¾€é­”æ³•ä¸–ç•Œçš„ç§˜å¯†ä¹‹é–€ã€‚" },
            { id: "u1-18", word: "amazed", part: "adj.", chinese: "æ„Ÿåˆ°é©šå¥‡çš„", sentence: "My dog just shook hands with me. I am really amazed by its new trick.", sentence_ch: "æˆ‘çš„ç‹—å‰›å‰›è·Ÿæˆ‘æ¡æ‰‹ã€‚æˆ‘å°ç‰ çš„æ–°æŠŠæˆ²æ„Ÿåˆ°å¾ˆé©šå¥‡ã€‚" },
            { id: "u1-19", word: "amaze", part: "v.", chinese: "ä½¿é©šå¥‡", sentence: "It amazed the old man that the phone app could speak to him.", sentence_ch: "æ‰‹æ©Ÿæ‡‰ç”¨ç¨‹å¼æœƒå°ä»–èªªè©±ï¼Œé€™è®“è€äººæ„Ÿåˆ°å¾ˆé©šå¥‡ã€‚" },
            { id: "u1-20", word: "earn", part: "v.", chinese: "è´å¾—ï¼Œè³ºï¼ˆéŒ¢ï¼‰", sentence: "My grandpa is kind to everyone. This earns him many friends.", sentence_ch: "æˆ‘çš„çˆºçˆºå°æ¯å€‹äººéƒ½å¾ˆå’Œå–„ã€‚é€™è®“ä»–è´å¾—äº†è¨±å¤šæœ‹å‹ã€‚" },
            { id: "u1-21", word: "pay off", part: "phr.", chinese: "å¾—åˆ°å¥½çµæœ", sentence: "After months of hard work, Evaâ€™s efforts to improve her grades finally paid off.", sentence_ch: "ç¶“éå¹¾å€‹æœˆçš„åŠªåŠ›ï¼ŒEva æå‡æˆç¸¾çš„åŠªåŠ›çµ‚æ–¼å¾—åˆ°äº†å›å ±ã€‚" },
            { id: "u1-22", word: "right away", part: "phr.", chinese: "ç«‹åˆ»ï¼Œé¦¬ä¸Š", sentence: "When the Korean actor appeared, his fans ran to him right away.", sentence_ch: "ç•¶é‚£ä½éŸ“åœ‹ç”·æ¼”å“¡å‡ºç¾æ™‚ï¼Œä»–çš„ç²‰çµ²ç«‹åˆ»è·‘å‘ä»–ã€‚" },
            { id: "u1-23", word: "stand out", part: "phr.", chinese: "çªå‡ºï¼Œå‡ºçœ¾", sentence: "Among the four smartphones, the silver one stands out because it is equipped with the best camera.", sentence_ch: "åœ¨é€™å››æ”¯æ™ºæ…§å‹æ‰‹æ©Ÿä¸­ï¼ŒéŠ€è‰²é‚£æ”¯å¾ˆçªå‡ºï¼Œå› ç‚ºå®ƒé…å‚™äº†æœ€å¥½çš„ç›¸æ©Ÿã€‚" },
            { id: "u1-24", word: "burst out", part: "phr.", chinese: "çªç„¶...", sentence: "When the boy burst out laughing on the MRT, many people looked at him strangely.", sentence_ch: "ç•¶é‚£å€‹ç”·å­©åœ¨æ·é‹ä¸Šçªç„¶å¤§ç¬‘æ™‚ï¼Œè¨±å¤šäººç”¨å¥‡æ€ªçš„çœ¼å…‰çœ‹è‘—ä»–ã€‚" },
            { id: "u1-25", word: "have nothing to do with", part: "phr.", chinese: "èˆ‡...ç„¡é—œ", sentence: "Although Sam was born into an acting family, his job has nothing to do with that.", sentence_ch: "é›–ç„¶ Sam å‡ºç”Ÿæ–¼æ¼”è—ä¸–å®¶ï¼Œä½†ä»–çš„å·¥ä½œèˆ‡æ­¤ç„¡é—œã€‚" }
        ];

        // --- Unit 2 å–®å­—è³‡æ–™ (Vocab Data) - æ›´æ–°ç‰ˆ ---
        const unit2VocabData = [
            { id: "u2-1", word: "rural", part: "adj.", chinese: "è¾²æ‘çš„ï¼Œé„‰æ‘çš„", sentence: "A farmer is riding his motorcycle on a rural road.", sentence_ch: "ä¸€ä½è¾²å¤«æ­£é¨è‘—æ‘©æ‰˜è»Šè¡Œé§›åœ¨é„‰é–“å°è·¯ä¸Šã€‚" },
            { id: "u2-2", word: "plastic", part: "adj.", chinese: "å¡‘è† çš„", sentence: "Leo likes to use plastic water bottles because they are light and easy to carry.", sentence_ch: "Leo å–œæ­¡ä½¿ç”¨å¡‘è† æ°´å£ºï¼Œå› ç‚ºå®ƒå€‘å¾ˆè¼•ä¸”å®¹æ˜“æ”œå¸¶ã€‚" },
            { id: "u2-3", word: "discover", part: "vt.", chinese: "ç™¼ç¾", sentence: "I discovered that there was a hole in Nancy's sock.", sentence_ch: "æˆ‘ç™¼ç¾ Nancy çš„è¥ªå­ä¸Šæœ‰å€‹æ´ã€‚" },
            { id: "u2-4", word: "discovery", part: "n.", chinese: "ç™¼ç¾", sentence: "The discovery of Ray's musical talent surprised everyone.", sentence_ch: "Ray éŸ³æ¨‚å¤©è³¦çš„ç™¼ç¾è®“å¤§å®¶éƒ½å¾ˆé©šè¨ã€‚" },
            { id: "u2-5", word: "stage", part: "n.", chinese: "èˆå°", sentence: "Look! The popular singer is singing on the stage!", sentence_ch: "ä½ çœ‹ï¼é‚£ä½å—æ­¡è¿çš„æ­Œæ‰‹æ­£åœ¨èˆå°ä¸Šå”±æ­Œï¼" },
            { id: "u2-6", word: "outdoor", part: "adj.", chinese: "æˆ¶å¤–çš„", sentence: "Emily enjoys many outdoor activities, such as hiking and biking.", sentence_ch: "Emily å–œæ­¡è¨±å¤šæˆ¶å¤–æ´»å‹•ï¼Œä¾‹å¦‚å¥è¡Œå’Œé¨è…³è¸è»Šã€‚" },
            { id: "u2-7", word: "outdoors", part: "adv.", chinese: "åœ¨æˆ¶å¤–", sentence: "It is warm today. Let's have lunch outdoors in the park.", sentence_ch: "ä»Šå¤©å¾ˆæº«æš–ã€‚æˆ‘å€‘å»å…¬åœ’åœ¨æˆ¶å¤–åƒåˆé¤å§ã€‚" },
            { id: "u2-8", word: "chop", part: "vt.", chinese: "åˆ‡ï¼Œå‰", sentence: "Terry is chopping meat and vegetables into pieces to make fried rice.", sentence_ch: "Terry æ­£åœ¨æŠŠè‚‰å’Œè”¬èœåˆ‡å¡Šä¾†åšç‚’é£¯ã€‚" },
            { id: "u2-9", word: "ingredient", part: "n.", chinese: "é£Ÿæ", sentence: "The main ingredients for making French toast are bread, eggs, and milk.", sentence_ch: "è£½ä½œæ³•å¼åå¸çš„ä¸»è¦é£Ÿææ˜¯éºµåŒ…ã€é›è›‹å’Œç‰›å¥¶ã€‚" },
            { id: "u2-10", word: "deliver", part: "vt.", chinese: "éé€", sentence: "The mail carrier is chased by a dog when he is delivering letters to the mailboxes in this area.", sentence_ch: "éƒµå·®åœ¨é€™å€‹åœ°å€é€ä¿¡åˆ°ä¿¡ç®±æ™‚è¢«ç‹—è¿½ã€‚" },
            { id: "u2-11", word: "delivery", part: "n.", chinese: "éé€", sentence: "This restaurant offers free delivery for any order over NT$800.", sentence_ch: "é€™å®¶é¤å»³æ¶ˆè²»æ»¿800å…ƒæä¾›å…è²»å¤–é€ã€‚" },
            { id: "u2-12", word: "decorate", part: "vt.", chinese: "è£é£¾", sentence: "Leo decorated his room with some pictures of his favorite comic characters.", sentence_ch: "Leo ç”¨ä¸€äº›ä»–æœ€å–œæ­¡çš„æ¼«ç•«è§’è‰²çš„åœ–ç‰‡è£é£¾ä»–çš„æˆ¿é–“ã€‚" },
            { id: "u2-13", word: "decoration", part: "n.", chinese: "è£é£¾å“", sentence: "Betty hung a Mickey Mouse toy on her backpack as a decoration.", sentence_ch: "Betty æ›äº†ä¸€å€‹ç±³è€é¼ ç©å…·åœ¨èƒŒåŒ…ä¸Šä½œç‚ºè£é£¾ã€‚" },
            { id: "u2-14", word: "meaning", part: "n.", chinese: "å«æ„", sentence: "When you type \"LOL,\" it has the meaning of laughing out loud.", sentence_ch: "ç•¶ä½ æ‰“ \"LOL\" æ™‚ï¼Œå®ƒçš„æ„æ€æ˜¯æ”¾è²å¤§ç¬‘ã€‚" },
            { id: "u2-15", word: "perform", part: "vi.; vt.", chinese: "è¡¨æ¼”", sentence: "My little sister performed in a play yesterday. She looked so charming on the stage!", sentence_ch: "æˆ‘å¦¹å¦¹æ˜¨å¤©åœ¨è©±åŠ‡ä¸­è¡¨æ¼”ã€‚å¥¹åœ¨èˆå°ä¸Šçœ‹èµ·ä¾†å¾ˆè¿·äººï¼" },
            { id: "u2-16", word: "performance", part: "n.", chinese: "è¡¨æ¼”", sentence: "Many people are watching a performance of popping dance on the street right now.", sentence_ch: "è¨±å¤šäººç¾åœ¨æ­£åœ¨è¡—ä¸Šè§€çœ‹æ©Ÿæ¢°èˆçš„è¡¨æ¼”ã€‚" },
            { id: "u2-17", word: "guest", part: "n.", chinese: "è³“å®¢", sentence: "The guests had dinner with us in our house last night.", sentence_ch: "å®¢äººå€‘æ˜¨æ™šåœ¨æˆ‘å€‘å®¶å’Œæˆ‘å€‘ä¸€èµ·åƒæ™šé¤ã€‚" },
            { id: "u2-18", word: "encourage", part: "vt.", chinese: "é¼“å‹µ", sentence: "Judy encouraged me to start my own hair salon business.", sentence_ch: "Judy é¼“å‹µæˆ‘å‰µæ¥­é–‹é«®å»Šã€‚" },
            { id: "u2-19", word: "grab", part: "vt.", chinese: "æŠ“å–", sentence: "Tom grabbed a sandwich from the table and ran to catch the school bus.", sentence_ch: "Tom å¾æ¡Œä¸ŠæŠ“äº†ä¸€å€‹ä¸‰æ˜æ²»ï¼Œè·‘å»è¶•æ ¡è»Šã€‚" },
            { id: "u2-20", word: "custom", part: "n.", chinese: "ç¿’ä¿—", sentence: "Dressing in green on St. Patrick's Day is a custom in Ireland and many cities in the United States.", sentence_ch: "åœ¨è–æ´¾ç¿ å…‹ç¯€ç©¿ç¶ è‰²è¡£æœæ˜¯æ„›çˆ¾è˜­å’Œç¾åœ‹è¨±å¤šåŸå¸‚çš„ç¿’ä¿—ã€‚" },
            { id: "u2-21", word: "generous", part: "adj.", chinese: "æ…·æ…¨çš„", sentence: "My uncle is very generous. He often provides food for homeless people.", sentence_ch: "æˆ‘å”å”å¾ˆæ…·æ…¨ã€‚ä»–ç¶“å¸¸æä¾›é£Ÿç‰©çµ¦ç„¡å®¶å¯æ­¸çš„äººã€‚" },
            { id: "u2-22", word: "impress", part: "vt.", chinese: "ä½¿å°è±¡æ·±åˆ»", sentence: "We were impressed by Katherine's great knowledge of math and science.", sentence_ch: "Katherine è±å¯Œçš„æ•¸å­¸å’Œç§‘å­¸çŸ¥è­˜è®“æˆ‘å€‘å°è±¡æ·±åˆ»ã€‚" },
            { id: "u2-23", word: "impression", part: "n.", chinese: "å°è±¡", sentence: "The amazing performance by the Cloud Gate Dance Theatre left a strong impression on me.", sentence_ch: "é›²é–€èˆé›†çš„ç²¾å½©è¡¨æ¼”çµ¦æˆ‘ç•™ä¸‹äº†æ·±åˆ»çš„å°è±¡ã€‚" },
            { id: "u2-24", word: "comment", part: "n.", chinese: "è©•è«–", sentence: "After Keith read his friend's Facebook post, he left a comment below it.", sentence_ch: "Keith è®€å®Œæœ‹å‹çš„è‡‰æ›¸è²¼æ–‡å¾Œï¼Œåœ¨ä¸‹æ–¹ç•™äº†è¨€ã€‚" },
            
            // Phrases
            { id: "u2-25", word: "a number of", part: "phr.", chinese: "ä¸€äº›", sentence: "A number of shoes are outside my house. There must be some guests inside.", sentence_ch: "æˆ‘å®¶é–€å¤–æœ‰ä¸€äº›é‹å­ã€‚è£¡é¢ä¸€å®šæœ‰äº›å®¢äººã€‚" },
            { id: "u2-26", word: "set off", part: "phr.", chinese: "æ–½æ”¾", sentence: "Some people are setting off firecrackers in front of the temple to celebrate the god's birthday.", sentence_ch: "æœ‰äº›äººæ­£åœ¨å»Ÿå‰æ”¾é­ç‚®æ…¶ç¥ç¥æ˜çš„ç”Ÿæ—¥ã€‚" },
            { id: "u2-27", word: "in total", part: "phr.", chinese: "ç¸½å…±", sentence: "The movie's box office reached ten million US dollars in total last week.", sentence_ch: "é€™éƒ¨é›»å½±ä¸Šé€±çš„ç¸½ç¥¨æˆ¿é”åˆ°äº†ä¸€åƒè¬ç¾å…ƒã€‚" },
            { id: "u2-28", word: "all of a sudden", part: "phr.", chinese: "çªç„¶", sentence: "All of a sudden, everyone stopped talking when the teacher entered the classroom.", sentence_ch: "è€å¸«ä¸€é€²æ•™å®¤ï¼Œå¤§å®¶çªç„¶åœæ­¢èªªè©±ã€‚" }
        ];

        // --- è³‡æ–™åº« (åœ¨æ­¤è™•å®šç¾©ï¼Œç¢ºä¿å‰é¢çš„ç”Ÿæˆå‡½å¼å·²å­˜åœ¨) ---
        const UNITS_DATA = {
            unit1: {
                title: "Unit 1",
                vocab: unit1VocabData,
                grammar: {
                    tips: [
                        { label: "è™›ä¸»è© It", text: "It is + adj. + (for äºº) + to V...." },
                        { label: "çœŸä¸»è©", text: "å¾Œé¢çš„ä¸å®šè© (to V) æ‰æ˜¯çœŸæ­£çš„ä¸»è©" },
                        { label: "æ¯”è¼ƒç´š", text: "A ... æ¯”è¼ƒç´š + than + B" },
                        { label: "è©æ€§åˆ¤æ–·", text: "Beå‹•è©/é€£ç¶´å‹•è©é…å½¢å®¹è©ï¼›ä¸€èˆ¬å‹•è©é…å‰¯è©" }
                    ],
                    notes: [
                        { 
                            title: "1. è™›ä¸»è© It çš„ç”¨æ³•", 
                            rule: "It + be å‹•è© + å½¢å®¹è© (+ for å°è±¡) + to + åŸå‹å‹•è©...", 
                            desc: "é€™å€‹æ–‡æ³•çš„æ ¸å¿ƒé‚è¼¯æ˜¯ï¼šã€Œä¸»èªå¤ªé•·äº†ï¼Œå…ˆç”¨ It ä½”ä½ç½®ï¼ŒæŠŠçœŸæ­£çš„å‹•ä½œæ”¾åˆ°å¾Œé¢å»ã€‚ã€\nç•¶æˆ‘å€‘æƒ³è¡¨é”ã€ŒåšæŸä»¶äº‹æ˜¯...çš„ã€æ™‚ï¼Œå¦‚æœç›´æ¥æŠŠäº‹æƒ…æ”¾åœ¨å¥é¦–æœƒé¡¯å¾—é ­é‡è…³è¼•ï¼Œå› æ­¤ç¿’æ…£ç”¨ It ç•¶ä½œå½¢å¼ä¸Šçš„ä¸»è©ã€‚", 
                            examples: [
                                "To learn English is important. (é ­é‡è…³è¼•)", 
                                "â†’ It is important to learn English. (ä½¿ç”¨è™›ä¸»è©)", 
                                "It is dangerous for children to play with fire."
                            ] 
                        },
                        { 
                            title: "2. å½¢å®¹è©èˆ‡å‰¯è©çš„æ¯”è¼ƒç´š", 
                            rule: "A + å‹•è© + æ¯”è¼ƒç´š (er/more...) + than + B", 
                            desc: "é€™å€‹æ–‡æ³•æœ€é›£çš„åœ°æ–¹åœ¨æ–¼ï¼šåˆ°åº•è¦ç”¨å½¢å®¹è©ï¼ˆtallï¼‰é‚„æ˜¯å‰¯è©ï¼ˆslowlyï¼‰ï¼Ÿ\né—œéµåœ¨æ–¼ã€Œå‹•è©ã€ï¼š\n1. è‹¥æ˜¯ Be å‹•è©æˆ–é€£ç¶´å‹•è© (look, feel...)ï¼Œç”¨å½¢å®¹è©æ¯”è¼ƒç´šã€‚\n2. è‹¥æ˜¯ä¸€èˆ¬å‹•è© (run, study...)ï¼Œç”¨å‰¯è©æ¯”è¼ƒç´šä¿®é£¾å‹•ä½œã€‚", 
                            examples: [
                                "He is taller than me. (Beå‹•è© + adj.)",
                                "She runs faster than her brother. (ä¸€èˆ¬å‹•è© + adv.)",
                                "This movie is more interesting than that one."
                            ] 
                        }
                    ],
                    quiz: generateUnit1QuizPool(),
                    scramble: generateUnit1GrammarScramble()
                }
            },
            unit2: {
                title: "Unit 2",
                vocab: unit2VocabData,
                grammar: {
                    tips: [
                        { label: "åè©å­å¥", text: "that + S + V ç•¶å—è© (thatå¯çœ)" },
                        { label: "æ„Ÿå®˜å‹•è©", text: "see/hear + O + VR / V-ing" },
                        { label: "å» to æ³•å‰‡", text: "æ„Ÿå®˜å‹•è©å¾Œé¢çµ•å°ä¸èƒ½æ¥ to V" },
                        { label: "å‹•è©é¸æ“‡", text: "VR(äº‹å¯¦/å…¨ç¨‹) vs V-ing(æ­£åœ¨é€²è¡Œ)" }
                    ],
                    notes: [
                        { 
                            title: "1. åè©å­å¥ï¼šthat å­å¥ç•¶å—è©", 
                            rule: "S + V (say/know/hope...) + (that) + S + V ...", 
                            desc: "é€™å€‹æ–‡æ³•æ˜¯ç”¨ä¾†è¡¨é”ã€ŒæŸäººèªªäº†ä»€éº¼ã€çŸ¥é“ä»€éº¼æˆ–å¸Œæœ›ä»€éº¼ã€ï¼Œå¾Œé¢çš„ that + ä¸»è© + å‹•è© å…¶å¯¦å°±æ˜¯æŠŠä¸€æ•´ä»¶äº‹ç•¶æˆä¸€å€‹ã€Œå¤§å—è©ã€ã€‚\n\nğŸ’¡ **æ–‡æ³•é‡é»**\nå¸¸æ¥æ­¤å­å¥çš„å‹•è©ï¼š say (èªª), know (çŸ¥é“), think (èªç‚º), hope (å¸Œæœ›), realize (ç­è§£), explain (è§£é‡‹)ã€‚\n**çœç•¥è¦å‰‡**ï¼š ç•¶ that å¼•å°çš„å­å¥æ˜¯ç•¶ã€Œå—è©ã€æ™‚ï¼Œthat é€šå¸¸å¯ä»¥çœç•¥ã€‚", 
                            examples: [
                                "I know (that) he is rich. (æˆ‘çŸ¥é“ä»–å¾ˆæœ‰éŒ¢)", 
                                "She said (that) she was busy. (å¥¹èªªå¥¹å¾ˆå¿™)", 
                                "We hope (that) you can come to the party."
                            ] 
                        },
                        { 
                            title: "2. æ„Ÿå®˜å‹•è©ï¼šçœ‹åˆ°/è½åˆ°æŸäººåšæŸäº‹", 
                            rule: "S + æ„Ÿå®˜å‹•è© + O + V(åŸå½¢) / V-ing", 
                            desc: "æ„Ÿå®˜å‹•è©æ˜¯ç”¨ä¾†æè¿°æ„Ÿå®˜ï¼ˆçœ‹ã€è½ã€æ„Ÿè¦ºï¼‰æ¥æ”¶åˆ°çš„å‹•ä½œï¼Œé‡é»åœ¨æ–¼å—è©å¾Œé¢çš„å‹•è©å½¢å¼ã€‚\n\nå¸¸è¦‹å‹•è©ï¼š see (çœ‹è¦‹), watch (è§€çœ‹), hear (è½è¦‹), listen to (è½)ã€‚\n\n**ç”¨æ³•å·®åˆ¥**ï¼š\n1. åŸå½¢å‹•è© (VR)ï¼š å¼·èª¿å‹•ä½œçš„äº‹å¯¦æˆ–å…¨ç¨‹ã€‚\n2. V-ingï¼š å¼·èª¿å‹•ä½œæ­£åœ¨é€²è¡Œä¸­ã€‚\n\nâœï¸ **è€ƒè©¦å°è¨£ç«…ï¼šçµ•å°ä¸èƒ½åŠ  \"to\"**\né€™æ˜¯è€ƒè©¦æœ€å¸¸è€ƒçš„é™·é˜±ã€‚é¸é …ä¸­å¦‚æœå‡ºç¾ to + Vï¼Œç›´æ¥ç•«æ‰ã€‚åªè¦è¨˜ä½ã€Œä¸æ˜¯åŸå½¢ï¼Œå°±æ˜¯ ingã€å°±èƒ½æ‹¿åˆ†ã€‚", 
                            examples: [
                                "I saw him run across the street. (å¼·èª¿çœ‹è¦‹éé¦¬è·¯çš„å…¨ç¨‹)",
                                "I heard her singing in the room. (å¼·èª¿è½è¦‹æ­£åœ¨å”±æ­Œ)",
                                "We watched them play basketball. (çœ‹ä»–å€‘æ‰“ç±ƒçƒ)"
                            ] 
                        }
                    ],
                    quiz: generateUnit2QuizPool(),
                    scramble: generateUnit2GrammarScramble()
                }
            }
        };

        // --- GameButton Component (Defined before use) ---
        const GameButton = ({ children, onClick, color = "blue", className = "", disabled = false, active = false }) => {
            const colorStyles = {
                blue: "bg-sky-400 border-sky-600 text-white hover:bg-sky-300",
                green: "bg-emerald-400 border-emerald-600 text-white hover:bg-emerald-300",
                yellow: "bg-yellow-400 border-yellow-600 text-yellow-900 hover:bg-yellow-300",
                red: "bg-rose-400 border-rose-600 text-white hover:bg-rose-300",
                purple: "bg-violet-400 border-violet-600 text-white hover:bg-violet-300",
                white: "bg-white border-slate-200 text-slate-700 hover:bg-slate-50",
                gray: "bg-slate-200 border-slate-400 text-slate-600 hover:bg-slate-300",
                active: "bg-yellow-400 border-yellow-600 text-yellow-900 ring-2 ring-yellow-200 ring-offset-2",
            };
            const finalColor = active ? colorStyles.active : (colorStyles[color] || colorStyles.blue);
            return (
                <button
                onClick={onClick}
                disabled={disabled}
                className={`
                    ${finalColor} 
                    border-b-4 active:border-b-0 active:translate-y-1 
                    rounded-2xl px-4 py-2 font-black tracking-wide 
                    transition-all duration-100 shadow-md 
                    flex items-center justify-center gap-2
                    disabled:opacity-50 disabled:cursor-not-allowed disabled:active:border-b-4 disabled:active:translate-y-0
                    ${className}
                `}
                >
                {children}
                </button>
            );
        };

        // --- å…ƒä»¶ 1: å–®å­—å­¸ç¿’æ¨¡å¼ ---
        const StudyMode = ({ data }) => {
            const [mode, setMode] = useState('card');
            const [currentIndex, setCurrentIndex] = useState(0);
            const [isFlipped, setIsFlipped] = useState(false);

            useEffect(() => {
                setCurrentIndex(0);
                setIsFlipped(false);
            }, [data]);

            if (!data || data.length === 0) return <div className="p-10 text-center text-slate-400 font-bold">ç›®å‰æ²’æœ‰è³‡æ–™</div>;

            const currentWord = data[currentIndex];
            const handleNext = () => { setIsFlipped(false); setTimeout(() => setCurrentIndex((prev) => (prev + 1) % data.length), 200); };
            const handlePrev = () => { setIsFlipped(false); setTimeout(() => setCurrentIndex((prev) => (prev - 1 + data.length) % data.length), 200); };

            return (
                <div className="flex flex-col h-full animate-in fade-in">
                    <div className="flex justify-center mb-6 gap-3">
                        <GameButton onClick={() => setMode('card')} active={mode === 'card'} color="white" className="text-sm"><Layers className="w-4 h-4" /> å¡ç‰Œ</GameButton>
                        <GameButton onClick={() => setMode('list')} active={mode === 'list'} color="white" className="text-sm"><LayoutList className="w-4 h-4" /> åˆ—è¡¨</GameButton>
                    </div>

                    {mode === 'card' ? (
                        <div className="flex-1 flex flex-col items-center justify-start min-h-[400px]">
                            <div 
                                className="relative w-full max-w-sm h-80 cursor-pointer group perspective-1000 z-10"
                                onClick={() => setIsFlipped(!isFlipped)}
                                style={{ perspective: '1000px' }}
                            >
                                <div 
                                    className="relative w-full h-full transition-transform duration-500"
                                    style={{ transformStyle: 'preserve-3d', transform: isFlipped ? 'rotateY(180deg)' : 'rotateY(0deg)' }}
                                >
                                    <div className="absolute inset-0 bg-white border-4 border-sky-400 rounded-3xl shadow-[0_8px_0_rgba(56,189,248,0.3)] flex flex-col items-center justify-center p-6" style={{ backfaceVisibility: 'hidden', WebkitBackfaceVisibility: 'hidden' }}>
                                        <div className="absolute top-4 right-6 bg-yellow-400 text-yellow-900 px-3 py-1 rounded-full text-sm font-black border-2 border-yellow-600 shadow-sm rotate-3">{currentIndex + 1} / {data.length}</div>
                                        <h2 className="text-3xl sm:text-4xl font-black text-slate-800 mb-2 tracking-tight text-center break-words w-full drop-shadow-sm">{currentWord.word}</h2>
                                        <span className="text-white bg-sky-500 font-bold px-4 py-1.5 rounded-xl text-lg shadow-md border-b-4 border-sky-700 transform -rotate-2">{currentWord.part}</span>
                                        <div className="mt-10 text-slate-400 text-xs font-bold flex items-center gap-1 animate-pulse bg-slate-100 px-3 py-1 rounded-full"><RefreshCw className="w-3 h-3" /> CLICK TO FLIP</div>
                                        <button onClick={(e) => { e.stopPropagation(); speakText(currentWord.word); }} className="absolute bottom-5 right-1/2 translate-x-1/2 p-3 bg-rose-400 text-white rounded-full border-b-4 border-rose-600 active:border-b-0 active:translate-y-1 transition-all shadow-md"><Volume2 className="w-6 h-6" /></button>
                                    </div>
                                    <div className="absolute inset-0 bg-violet-500 border-4 border-violet-700 text-white rounded-3xl shadow-[0_8px_0_rgba(109,40,217,0.3)] flex flex-col items-center justify-center p-8" style={{ backfaceVisibility: 'hidden', WebkitBackfaceVisibility: 'hidden', transform: 'rotateY(180deg)' }}>
                                        <h3 className="text-2xl sm:text-3xl font-black mb-4 text-center leading-snug drop-shadow-md bg-white/20 px-4 py-2 rounded-xl backdrop-blur-sm border-2 border-white/30 transform -rotate-1">{currentWord.chinese}</h3>
                                        <div className="bg-black/20 p-4 rounded-xl border-2 border-white/10 w-full relative overflow-y-auto max-h-[140px]">
                                            <p className="text-white text-center italic text-sm sm:text-base leading-relaxed font-bold">"{currentWord.sentence}"</p>
                                            <p className="text-violet-200 text-center text-xs mt-2 font-medium">{currentWord.sentence_ch}</p>
                                        </div>
                                        <button onClick={(e) => { e.stopPropagation(); speakText(currentWord.sentence); }} className="mt-4 p-3 bg-yellow-400 text-yellow-900 rounded-full border-b-4 border-yellow-600 active:border-b-0 active:translate-y-1 transition-all shadow-md"><Volume2 className="w-5 h-5" /></button>
                                    </div>
                                </div>
                            </div>
                            <div className="flex gap-4 mt-8 w-full max-w-sm px-4">
                                <GameButton onClick={handlePrev} color="white" className="flex-1"><ChevronLeft className="w-6 h-6" /> ä¸Šä¸€å€‹</GameButton>
                                <GameButton onClick={handleNext} color="blue" className="flex-1 text-lg">ä¸‹ä¸€å€‹ <ChevronRight className="w-6 h-6" /></GameButton>
                            </div>
                        </div>
                    ) : (
                        <div className="flex-1 overflow-y-auto max-h-[70vh] pr-1 space-y-3 pb-20">
                            {data.map((item) => (
                                <div key={item.id} className="bg-white p-4 rounded-2xl border-b-4 border-slate-200 flex items-center justify-between hover:translate-x-1 transition-all group">
                                    <div className="flex-1">
                                        <div className="flex items-center gap-2 mb-1">
                                            <span className="font-black text-lg text-slate-700 group-hover:text-sky-500 transition-colors">{item.word}</span>
                                            <span className="text-xs text-white bg-slate-400 px-2 py-0.5 rounded-lg font-bold border-b-2 border-slate-600">{item.part}</span>
                                        </div>
                                        <div className="text-slate-500 text-sm font-bold">{item.chinese}</div>
                                    </div>
                                    <button onClick={() => speakText(item.word)} className="p-2 bg-sky-100 text-sky-500 rounded-xl hover:bg-sky-200 active:scale-95 transition-colors"><Volume2 className="w-5 h-5" /></button>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        // --- å…ƒä»¶ 2.1: æ‹¼å­—æ¸¬é©— (ä¿®æ­£ç‰ˆ: æ–°å¢æç¤ºèˆ‡æŸ¥çœ‹ç­”æ¡ˆ) ---
        const SpellingQuiz = ({ data, onFinish }) => {
            const [currentQIndex, setCurrentQIndex] = useState(0);
            const [quizItems, setQuizItems] = useState([]);
            const [currentLetters, setCurrentLetters] = useState([]); 
            const [poolLetters, setPoolLetters] = useState([]); 
            const [feedback, setFeedback] = useState(null); 
            const [score, setScore] = useState(0);
            const [targetPattern, setTargetPattern] = useState([]); 
            const [targetClean, setTargetClean] = useState([]); 

            useEffect(() => {
                if (!data || data.length === 0) return;
                const shuffled = shuffleArray([...data]).slice(0, 10);
                setQuizItems(shuffled);
                setCurrentQIndex(0);
                setScore(0);
                if (shuffled.length > 0) loadQuestion(shuffled[0]);
            }, [data]);

            const loadQuestion = (item) => {
                if(!item) return;
                const rawWord = item.word.toLowerCase();
                setTargetPattern(rawWord.split(''));
                const cleanChars = rawWord.replace(/[^a-z]/g, '').split('');
                setTargetClean(cleanChars);
                
                const scrambled = cleanChars.map((char, idx) => ({ char, id: idx, key: `${char}-${idx}-${Math.random()}` }));
                setPoolLetters(shuffleArray([...scrambled]));
                setCurrentLetters([]);
                setFeedback(null);
                speakText(item.word);
            };

            const handlePoolClick = (l) => { if (feedback === 'correct') return; setPoolLetters(prev => prev.filter(p => p.key !== l.key)); setCurrentLetters(prev => [...prev, l]); };
            const handleAnswerClick = (l) => { if (feedback === 'correct') return; setCurrentLetters(prev => prev.filter(p => p.key !== l.key)); setPoolLetters(prev => [...prev, l]); };

            const handleHint = () => {
                if (feedback === 'correct') return;
                const nextCharIndex = currentLetters.length;
                if (nextCharIndex >= targetClean.length) return; 

                const neededChar = targetClean[nextCharIndex];
                const candidate = poolLetters.find(l => l.char === neededChar);
                if (candidate) {
                    handlePoolClick(candidate);
                }
            };

            const handleSolve = () => {
                if (feedback === 'correct') return;
                
                let tempPool = [...poolLetters, ...currentLetters];
                const solution = [];
                const remainingPool = [...tempPool];

                for (const char of targetClean) {
                    const foundIndex = remainingPool.findIndex(l => l.char === char);
                    if (foundIndex !== -1) {
                        solution.push(remainingPool[foundIndex]);
                        remainingPool.splice(foundIndex, 1);
                    }
                }

                setCurrentLetters(solution);
                setPoolLetters(remainingPool);
            };

            const checkAnswer = () => {
                if (feedback === 'correct') return;

                const currentItem = quizItems[currentQIndex];
                if (!currentItem) return;
                const targetWord = currentItem.word.toLowerCase().replace(/[^a-z]/g, '');
                const userWord = currentLetters.map(l => l.char).join('');
                if (userWord === targetWord) {
                    setFeedback('correct');
                    speakText("Correct! " + currentItem.word);
                    setScore(prev => prev + 10);
                    setTimeout(handleNext, 1500);
                } else {
                    setFeedback('wrong');
                    speakText("Try again");
                    setTimeout(() => setFeedback(null), 1000);
                }
            };

            const handleNext = () => {
                if (currentQIndex < quizItems.length - 1) {
                    const nextIndex = currentQIndex + 1;
                    setCurrentQIndex(nextIndex);
                    loadQuestion(quizItems[nextIndex]);
                } else {
                    onFinish(score + (feedback === 'correct' ? 10 : 0));
                }
            };

            if (!quizItems || quizItems.length === 0) return <div className="p-10 text-center text-slate-400 font-bold">è¼‰å…¥ä¸­æˆ–ç„¡è³‡æ–™...</div>;
            const currentItem = quizItems[currentQIndex];
            if (!currentItem) return null;
            let letterIndex = 0;

            return (
                <div className="flex flex-col items-center">
                    <div className="w-full flex justify-between items-center mb-4 px-2">
                         <span className="text-xs font-black text-slate-400">SPELLING {currentQIndex + 1} / {quizItems.length}</span>
                         <span className="text-xs font-black text-yellow-600 bg-yellow-100 px-2 py-1 rounded-lg">SCORE: {score}</span>
                    </div>
                    <div className="bg-white border-4 border-b-8 border-violet-200 rounded-3xl p-8 mb-6 text-center w-full relative shadow-sm">
                        <div className="absolute top-3 left-1/2 -translate-x-1/2 bg-violet-100 text-violet-600 px-3 py-1 rounded-lg text-xs font-black uppercase tracking-wider">Listen & Spell</div>
                        <h2 className="font-black text-3xl text-slate-800 mt-4 mb-2">{currentItem.chinese}</h2>
                        <button onClick={() => speakText(currentItem.word)} className="p-4 bg-sky-100 text-sky-500 rounded-full hover:bg-sky-200 active:scale-95 transition-colors border-4 border-sky-200"><Volume2 className="w-8 h-8" /></button>
                        <p className="mt-2 text-slate-400 text-xs font-bold">é»æ“Šå–‡å­è½ç™¼éŸ³</p>
                    </div>
                    <div className="relative flex flex-wrap justify-center items-end gap-2 min-h-[80px] mb-6 p-4 bg-slate-200 rounded-3xl w-full border-inner border-4 border-slate-300">
                        {targetPattern.map((char, idx) => {
                            if (/[a-z]/.test(char)) {
                                const filledLetter = currentLetters[letterIndex];
                                letterIndex++;
                                return filledLetter ? (
                                    <button key={`filled-${idx}`} onClick={() => handleAnswerClick(filledLetter)} className="w-10 h-12 bg-indigo-500 text-white rounded-lg font-black text-2xl shadow-[0_4px_0_rgb(55,48,163)] active:translate-y-1 active:shadow-none transition-all pop-in mx-[1px]">{filledLetter.char}</button>
                                ) : <div key={`empty-${idx}`} className="w-10 h-12 bg-white/50 rounded-lg border-b-4 border-slate-300 mx-[1px]"></div>;
                            } else if (char === ' ') {
                                return <div key={`space-${idx}`} className="w-6 h-12 flex items-center justify-center"></div>;
                            } else {
                                return <div key={`symbol-${idx}`} className="w-6 h-12 flex items-end justify-center pb-2 text-slate-400 font-black text-xl">{char}</div>;
                            }
                        })}
                        {currentLetters.length === 0 && <div className="absolute inset-0 flex items-center justify-center pointer-events-none opacity-50"><span className="text-slate-500 font-bold text-sm bg-slate-200/80 px-2 py-1 rounded">é»æ“Šä¸‹æ–¹å­—æ¯æ‹¼å­—</span></div>}
                    </div>
                    <div className="flex flex-wrap justify-center gap-3 mb-8">
                        {poolLetters.map((l) => (
                             <button key={l.key} onClick={() => handlePoolClick(l)} className="w-12 h-14 bg-white text-slate-700 border-b-4 border-slate-300 rounded-xl font-black text-2xl shadow-sm hover:bg-slate-50 active:border-b-0 active:translate-y-1 transition-all">{l.char}</button>
                        ))}
                    </div>
                    <div className={`w-full transition-all duration-300 flex flex-col gap-2 ${feedback === 'wrong' ? 'animate-shake' : ''}`}>
                         <div className="flex gap-2 w-full">
                            <GameButton onClick={handleHint} color="yellow" className="flex-1 text-sm py-3" disabled={feedback === 'correct'}>
                                <Lightbulb className="w-4 h-4" /> ğŸ’¡ æç¤ºä¸€å­—
                            </GameButton>
                            <GameButton onClick={handleSolve} color="red" className="flex-1 text-sm py-3" disabled={feedback === 'correct'}>
                                <Eye className="w-4 h-4" /> ğŸ‘€ æŸ¥çœ‹ç­”æ¡ˆ
                            </GameButton>
                         </div>

                         <GameButton onClick={checkAnswer} color={feedback === 'correct' ? 'green' : (feedback === 'wrong' ? 'red' : 'blue')} className="w-full py-4 text-xl" disabled={currentLetters.length === 0}>
                            {feedback === 'correct' ? <><CheckCircle /> Correct!</> : (feedback === 'wrong' ? <><XCircle /> Wrong!</> : "Check Answer")}
                        </GameButton>
                    </div>
                </div>
            );
        };

        // --- å…ƒä»¶ 3: é‡çµ„å¥å­æ¨¡å¼ (ç©æœ¨é¢¨æ ¼) ---
        const ScrambleMode = ({ data, titleOverride }) => {
            const [questions, setQuestions] = useState([]);
            const [currentIndex, setCurrentIndex] = useState(0);
            const [score, setScore] = useState(0);
            const [showResult, setShowResult] = useState(false);
            const [userSentence, setUserSentence] = useState([]); 
            const [availableWords, setAvailableWords] = useState([]); 
            const [feedback, setFeedback] = useState(null); 
            const [showGiveUpConfirm, setShowGiveUpConfirm] = useState(false); 
            const [showHelperHint, setShowHelperHint] = useState(false); 

            useEffect(() => { resetGame(); }, [data]);
        
            const resetGame = () => {
                if (!data || data.length === 0) return;
                const count = 5; // æ¯æ¬¡åªå‡º 5 é¡Œ
                const shuffledQuestions = shuffleArray([...data]).slice(0, count); 
                setQuestions(shuffledQuestions);
                setCurrentIndex(0);
                setScore(0);
                setShowResult(false);
                if(shuffledQuestions.length > 0) loadQuestion(shuffledQuestions[0]);
            };
        
            const loadQuestion = (question) => {
                if (!question) return;
                const rawSentence = question.sentence;
                const spacedSentence = rawSentence.replace(/([.!?])$/, ' $1');
                const words = spacedSentence.split(' ');
                const wordsWithIds = words.map((word, index) => ({ id: `${index}-${word}`, text: word }));
                setAvailableWords(shuffleArray(wordsWithIds));
                setUserSentence([]);
                setFeedback(null);
                setShowGiveUpConfirm(false);
                setShowHelperHint(false);
            };
        
            const handleSkipQuestion = () => {
                if (questions.length <= 1) return; 
                const currentQuestionIds = questions.map(q => q.id);
                const candidates = data.filter(item => !currentQuestionIds.includes(item.id));
                let newQuestion;
                if (candidates.length > 0) {
                    newQuestion = candidates[Math.floor(Math.random() * candidates.length)];
                } else {
                    const otherQuestions = data.filter(item => item.id !== questions[currentIndex].id);
                    newQuestion = otherQuestions[Math.floor(Math.random() * otherQuestions.length)];
                }
                const newQuestions = [...questions];
                newQuestions[currentIndex] = newQuestion;
                setQuestions(newQuestions);
                loadQuestion(newQuestion);
            };

            const handleWordClick = (wordObj) => { if (feedback === 'correct') return; if (feedback === 'wrong') setFeedback(null); setAvailableWords(prev => prev.filter(w => w.id !== wordObj.id)); setUserSentence(prev => [...prev, wordObj]); };
            const handleAnswerClick = (wordObj) => { if (feedback === 'correct') return; if (feedback === 'wrong') setFeedback(null); setUserSentence(prev => prev.filter(w => w.id !== wordObj.id)); setAvailableWords(prev => [...prev, wordObj]); };
            const handleTryAgain = () => { setFeedback(null); setShowHelperHint(true); setTimeout(() => setShowHelperHint(false), 5000); };
            const handleMagicHint = () => {
                if (feedback === 'correct') return;
                setFeedback(null);
                
                // 1. æ‰¾å‡ºç¬¬ä¸€å€‹éŒ¯èª¤çš„ä½ç½®
                let firstWrongIndex = -1;
                for (let i = 0; i < userSentence.length; i++) { 
                    if (!userSentence[i].id.startsWith(`${i}-`)) { 
                        firstWrongIndex = i; 
                        break; 
                    } 
                }
                // å¦‚æœç›®å‰å¡«çš„éƒ½å°ï¼Œä½ç½®å°±æ˜¯ä¸‹ä¸€å€‹ç©ºæ ¼
                if (firstWrongIndex === -1) firstWrongIndex = userSentence.length;
                
                // æª¢æŸ¥æ˜¯å¦å·²å…¨éƒ¨å®Œæˆ
                const totalWords = userSentence.length + availableWords.length;
                if (firstWrongIndex >= totalWords) return;

                // 2. æ‰¾å‡ºæ­£ç¢ºçš„å–®å­—ç‰©ä»¶
                const targetIdPrefix = `${firstWrongIndex}-`;
                const allWords = [...userSentence, ...availableWords];
                const nextWordObj = allWords.find(w => w.id.startsWith(targetIdPrefix));

                if (nextWordObj) {
                    // 3. é‡çµ„ç‹€æ…‹ï¼šä¿ç•™å‰é¢æ­£ç¢ºçš„ + è£œä¸Šé€™ä¸€å€‹æ­£ç¢ºçš„
                    const newCorrectUserSentence = [...userSentence.slice(0, firstWrongIndex), nextWordObj];
                    
                    // 4. å‰©ä¸‹çš„å­—å…¨éƒ¨æ”¾å›å¾…é¸å€ (éæ¿¾æ‰å·²ç¶“åœ¨ç­”æ¡ˆå€çš„å­—)
                    const newAvailableWords = allWords.filter(w => !newCorrectUserSentence.some(cw => cw.id === w.id));

                    setUserSentence(newCorrectUserSentence);
                    setAvailableWords(newAvailableWords);
                    speakText(nextWordObj.text);
                }
            };

            const handleGiveUpClick = () => { setFeedback(null); setShowGiveUpConfirm(true); };
            const confirmGiveUp = () => {
                const allWords = [...userSentence, ...availableWords];
                allWords.sort((a, b) => { const indexA = parseInt(a.id.split('-')[0]); const indexB = parseInt(b.id.split('-')[0]); return indexA - indexB; });
                setUserSentence(allWords);
                setAvailableWords([]);
                setFeedback('correct'); 
                setShowGiveUpConfirm(false);
            };

            const checkAnswer = () => {
                const currentQuestion = questions[currentIndex];
                const targetSentence = currentQuestion.sentence.replace(/\s+([.!?])/g, '$1'); 
                const userRawString = userSentence.map(w => w.text).join(' ');
                const userCleanString = userRawString.replace(/\s+([.!?])/g, '$1');
                if (userCleanString === targetSentence) { 
                    // 1. æ–°å¢ï¼šé˜²æ­¢é‡è¤‡é»æ“ŠåŠ åˆ†
                    if (feedback === 'correct') return;
                    setFeedback('correct'); 
                    setScore(prev => prev + 20); 
                    speakText(currentQuestion.sentence); 
                } else { 
                    setFeedback('wrong'); 
                    speakText("Oops"); 
                }
            };
            const nextQuestion = () => { if (currentIndex < questions.length - 1) { setCurrentIndex(prev => prev + 1); loadQuestion(questions[currentIndex + 1]); } else { setShowResult(true); } };

            if (!questions || questions.length === 0) return <div className="p-10 text-center font-bold text-slate-400">Loading or No Data...</div>;
            if (showResult) return (
                <div className="flex flex-col items-center justify-center h-full animate-in zoom-in py-10 relative overflow-hidden">
                    <Star className="w-32 h-32 text-yellow-400 mb-6 fill-yellow-400 drop-shadow-[0_4px_0_rgba(234,179,8,1)] animate-bounce" />
                    <h2 className="text-4xl font-black text-slate-800 mb-2 tracking-tight">æŒ‘æˆ°æˆåŠŸï¼</h2>
                    <div className="text-7xl font-black text-indigo-600 mb-8 drop-shadow-sm">{score}</div>
                    <GameButton onClick={resetGame} color="purple" className="w-64 py-4 text-xl"><RefreshCw className="w-6 h-6" /> å†ç©ä¸€æ¬¡</GameButton>
                </div>
            );
        
            const currentQ = questions[currentIndex];
            return (
            <div className="flex flex-col h-full max-w-2xl mx-auto pb-24 relative">
                <div className="absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none z-0 opacity-30"><div className="absolute top-10 left-10 text-yellow-300"><Star size={40} /></div><div className="absolute top-40 right-10 text-rose-300"><Puzzle size={50} /></div><div className="absolute bottom-20 left-20 text-sky-300"><Gamepad2 size={60} /></div></div>
                <div className="bg-white border-4 border-b-8 border-orange-200 rounded-3xl p-6 mb-6 text-center relative z-10 shadow-sm">
                    <div className="flex justify-between items-center mb-2">
                        <div className="inline-block bg-orange-100 text-orange-600 font-black px-3 py-1 rounded-lg text-xs border-2 border-orange-200">{titleOverride ? titleOverride : `LEVEL ${currentIndex + 1}`}</div>
                        {currentQ?.word && <div className="text-xs font-bold text-slate-400 bg-slate-100 px-2 py-1 rounded">Target: {currentQ.word}</div>}
                    </div>
                    <h2 className="font-black text-2xl text-slate-800 mb-4 leading-relaxed drop-shadow-sm">{currentQ?.sentence_ch}</h2>
                    <p className="text-orange-500 text-sm font-bold bg-orange-50 px-4 py-1.5 rounded-full inline-block border-2 border-orange-100 animate-pulse">è«‹ç”¨ä¸‹æ–¹çš„ç©æœ¨æ‹¼å‡ºé€™å¥è‹±æ–‡</p>
                </div>
                <div className="bg-slate-200/50 rounded-3xl shadow-inner border-4 border-slate-300 min-h-[160px] p-5 mb-6 flex flex-wrap content-center justify-center gap-3 relative transition-all z-10">
                    {userSentence.length === 0 && <div className="text-slate-400 font-black pointer-events-none flex flex-col items-center"><Puzzle className="w-10 h-10 mb-2 opacity-50" />è«‹ä¾åºé»æ“Šä¸‹æ–¹çš„è‹±æ–‡å–®å­—</div>}
                    {userSentence.map((wordObj) => (<button key={wordObj.id} onClick={() => handleAnswerClick(wordObj)} className="bg-indigo-500 text-white px-4 py-3 rounded-xl font-bold shadow-[0_4px_0_rgb(55,48,163)] active:shadow-none active:translate-y-1 transition-all border-2 border-indigo-400 text-lg animate-in zoom-in">{wordObj.text}</button>))}
                </div>
                <div className="h-20 mb-4 flex items-center justify-center gap-3 z-10 relative">
                    {feedback === 'correct' ? (
                        <div className="w-full bg-emerald-100 border-4 border-emerald-300 text-emerald-700 px-6 py-4 rounded-3xl flex items-center justify-between shadow-lg animate-in slide-in-from-bottom-2">
                            <div className="flex items-center gap-2 font-black text-xl"><CheckCircle className="w-8 h-8 text-emerald-500" /> CORRECT!</div>
                            <GameButton onClick={nextQuestion} color="green" className="text-sm">NEXT <ChevronRight className="w-4 h-4" /></GameButton>
                        </div>
                    ) : feedback === 'wrong' ? (
                        <div className="w-full flex justify-center animate-in shake">
                            <button onClick={handleTryAgain} className="bg-rose-500 text-white border-b-4 border-rose-700 active:border-b-0 active:translate-y-1 px-8 py-3 rounded-2xl font-black text-xl shadow-xl flex items-center gap-2 hover:bg-rose-600 transition-all w-full justify-center"><XCircle className="w-8 h-8" /> TRY AGAIN! (é»æ“Šé‡è©¦)</button>
                        </div>
                    ) : (
                        <>
                        <div className="flex gap-2 relative">
                                {showHelperHint && <div className="absolute -top-20 left-0 bg-white border-4 border-sky-400 p-3 rounded-2xl w-48 shadow-xl z-50 animate-in fade-in slide-in-from-bottom-2"><p className="text-sky-600 text-xs font-black mb-1">ğŸ’¡ å¡é—œäº†å—ï¼Ÿ</p><p className="text-slate-600 text-xs font-bold">è©¦è©¦å·¦é‚Šçš„é­”æ³•æ£’æˆ–æŠ•é™æ——å¹Ÿå–”ï¼</p><div className="absolute -bottom-3 left-6 w-4 h-4 bg-white border-b-4 border-r-4 border-sky-400 transform rotate-45"></div></div>}
                                <GameButton onClick={handleSkipQuestion} color="purple" className="py-4" title="æ›ä¸€é¡Œ"><Shuffle className="w-6 h-6" /></GameButton>
                                <GameButton onClick={handleMagicHint} color="yellow" className="py-4" title="æç¤ºä¸‹ä¸€å€‹å­—"><Wand2 className="w-6 h-6" /></GameButton>
                                <GameButton onClick={handleGiveUpClick} color="red" className="py-4" title="æŸ¥çœ‹ç­”æ¡ˆ"><Flag className="w-6 h-6" /></GameButton>
                        </div>
                        <GameButton onClick={checkAnswer} disabled={userSentence.length === 0} color="blue" className="flex-1 py-4 text-xl shadow-lg"><CheckCircle className="w-6 h-6" /> æª¢æŸ¥</GameButton>
                        </>
                    )}
                </div>
                <div className="flex flex-wrap gap-2 justify-center z-10 relative pb-4">
                    {availableWords.map((wordObj) => (<button key={wordObj.id} onClick={() => handleWordClick(wordObj)} className="bg-white text-slate-700 px-5 py-3 rounded-xl font-bold shadow-[0_4px_0_rgb(203,213,225)] active:shadow-none active:translate-y-1 transition-all border-2 border-slate-200 text-lg hover:border-indigo-300 hover:text-indigo-600">{wordObj.text}</button>))}
                </div>
                {showGiveUpConfirm && (
                    <div className="absolute inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm rounded-3xl animate-in fade-in">
                        <div className="bg-white p-6 rounded-3xl border-4 border-slate-200 shadow-2xl max-w-xs text-center transform scale-100 animate-in zoom-in">
                            <div className="flex justify-center mb-4"><AlertCircle className="w-16 h-16 text-yellow-400" /></div>
                            <h3 className="text-2xl font-black text-slate-800 mb-2">Wait!</h3>
                            <p className="text-slate-500 font-bold mb-6">çœŸçš„ä¸è‡ªå·±å†è©¦è©¦çœ‹å—ï¼Ÿ<br/>è‡ªå·±æ‹¼å‡ºä¾†æœƒå¾ˆæœ‰æˆå°±æ„Ÿå–”ï¼</p>
                            <div className="flex gap-3 justify-center">
                                <GameButton onClick={() => setShowGiveUpConfirm(false)} color="blue" className="text-sm">å†è©¦ä¸€æ¬¡</GameButton>
                                <GameButton onClick={confirmGiveUp} color="gray" className="text-sm">æˆ‘çœ‹ç­”æ¡ˆ</GameButton>
                            </div>
                        </div>
                    </div>
                )}
            </div>
            );
        };

        // --- å…ƒä»¶ 2: æ¸¬é©—æ¨¡å¼ (æ•´åˆ & é¸æ“‡é¡Œå¤§äº‚é¬¥ & æ‹¼å­—åˆ†é¡) ---
        const QuizMode = ({ data, grammarData }) => {
            const [quizType, setQuizType] = useState('choice'); 
            const [status, setStatus] = useState('menu'); 
            const [currentQIndex, setCurrentQIndex] = useState(0);
            const [score, setScore] = useState(0);
            const [quizData, setQuizData] = useState([]);
            const [selectedOption, setSelectedOption] = useState(null);
            const [spellingData, setSpellingData] = useState([]); // æ–°å¢ï¼šç”¨æ–¼å„²å­˜éæ¿¾å¾Œçš„æ‹¼å­—è³‡æ–™
            const [timeLeft, setTimeLeft] = useState(7); // æ–°å¢ï¼šå€’æ•¸æ™‚é–“ç‹€æ…‹
            const [history, setHistory] = useState([]); // æ–°å¢ï¼šç­”é¡Œæ­·å²ç´€éŒ„

            const startChoiceQuiz = () => {
                if (!data || data.length === 0) return;
                // ä¿®æ”¹ï¼šå¢åŠ é¡Œæ•¸è‡³ 50 é¡Œ (ä½¿ç”¨é›™å‘å‡ºé¡Œå¢åŠ é¡Œåº«é‡)
                const allVocabQuestions = [];
                data.forEach(target => {
                    // Q1: è‹± -> ä¸­
                    const distractors1 = shuffleArray(data.filter(w => w.id !== target.id)).slice(0, 3);
                    allVocabQuestions.push({
                        questionText: target.word,
                        correctId: target.id,
                        correctAnswer: target.chinese, // ç´€éŒ„æ­£ç¢ºç­”æ¡ˆæ–‡å­—
                        options: shuffleArray([target, ...distractors1]).map(o => ({
                            id: o.id,
                            text: o.chinese,
                            isCorrect: o.id === target.id
                        })),
                        hint: "è«‹é¸å‡ºä¸­æ–‡æ„æ€",
                        audio: target.word
                    });
                    
                    // Q2: ä¸­ -> è‹±
                    const distractors2 = shuffleArray(data.filter(w => w.id !== target.id)).slice(0, 3);
                    allVocabQuestions.push({
                        questionText: target.chinese,
                        correctId: target.id,
                        correctAnswer: target.word, // ç´€éŒ„æ­£ç¢ºç­”æ¡ˆæ–‡å­—
                        options: shuffleArray([target, ...distractors2]).map(o => ({
                            id: o.id,
                            text: o.word,
                            isCorrect: o.id === target.id
                        })),
                        hint: "è«‹é¸å‡ºè‹±æ–‡å–®å­—",
                        audio: null
                    });
                });

                // éš¨æ©Ÿé¸å– 10 é¡Œ
                const selectedQuestions = shuffleArray(allVocabQuestions).slice(0, 10);
                
                setQuizData(selectedQuestions);
                setCurrentQIndex(0);
                setScore(0);
                setHistory([]);
                setSelectedOption(null);
                setQuizType('choice');
                setStatus('playing');
                setTimeLeft(7); // é‡ç½®æ™‚é–“
            };

            const startSpellingQuiz = (type) => {
                let filteredData = [];
                if (!data) return;
                if (type === 'words') {
                    // éæ¿¾æ‰ç‰‡èª (part !== 'phr.')
                    filteredData = data.filter(item => item.part !== 'phr.');
                } else if (type === 'phrases') {
                    // åªç•™ç‰‡èª (part === 'phr.')
                    filteredData = data.filter(item => item.part === 'phr.');
                }

                if (filteredData.length === 0) {
                    alert("é€™å€‹å–®å…ƒæ²’æœ‰é€™é¡å‹çš„é¡Œç›®å–”ï¼");
                    return;
                }

                setSpellingData(filteredData);
                setQuizType('spelling');
                setStatus('playing');
            };

            const handleOptionClick = (option) => {
                if (selectedOption) return; 
                
                // è¨ˆç®—åˆ†æ•¸ (å‰©é¤˜æ™‚é–“æ¯”ä¾‹ * 100ï¼Œç„¡æ¢ä»¶é€²ä½)
                let points = 0;
                if (option.isCorrect) {
                    points = Math.ceil((timeLeft / 7.0) * 100);
                    // ç¢ºä¿è‡³å°‘æœ‰ä¸€é»åˆ†æ•¸ (å¦‚æœæ­£ç¢ºä¸”æ™‚é–“æœªåˆ°)
                    if (points <= 0 && timeLeft > 0) points = 10; 
                }

                const currentQ = quizData[currentQIndex];
                
                // è¨˜éŒ„æ­·å²
                setHistory(prev => [...prev, {
                    q: currentQ.questionText,
                    correct: currentQ.correctAnswer,
                    user: option.text,
                    isCorrect: option.isCorrect,
                    points: points
                }]);

                setSelectedOption(option);
                if (currentQ.audio) speakText(currentQ.audio);
                
                if (option.isCorrect) {
                    setScore(prev => prev + points);
                }
            };

            const nextQuestion = () => {
                if (currentQIndex < quizData.length - 1) {
                    setCurrentQIndex(prev => prev + 1);
                    setSelectedOption(null);
                    setTimeLeft(7); // é‡ç½®æ™‚é–“
                } else {
                    setStatus('result');
                }
            };

            // å€’æ•¸è¨ˆæ™‚å™¨ Effect
            useEffect(() => {
                if (status !== 'playing' || quizType !== 'choice' || selectedOption) return;

                if (timeLeft <= 0) {
                    // æ™‚é–“åˆ°è™•ç†é‚è¼¯
                    const currentQ = quizData[currentQIndex];
                    setHistory(prev => [...prev, {
                        q: currentQ.questionText,
                        correct: currentQ.correctAnswer,
                        user: "(é€¾æ™‚)",
                        isCorrect: false,
                        points: 0
                    }]);

                    setSelectedOption({ id: 'timeout' }); // æ¨™è¨˜ç‚ºè¶…æ™‚
                    speakText("Time's up");
                    return;
                }

                const timer = setInterval(() => {
                    setTimeLeft(prev => prev - 1);
                }, 1000);

                return () => clearInterval(timer);
            }, [timeLeft, status, quizType, selectedOption]);

            // è¨ˆç®—æ˜¯å¦æœ‰ç‰‡èªï¼Œæ±ºå®šæ˜¯å¦é¡¯ç¤ºã€Œç‰‡èªç¯‡ã€æŒ‰éˆ•
            const hasPhrases = data ? data.some(item => item.part === 'phr.') : false;
            const hasWords = data ? data.some(item => item.part !== 'phr.') : false;

            if (status === 'menu') {
                return (
                    <div className="flex flex-col items-center justify-center h-full animate-in fade-in space-y-4 pt-4 overflow-y-auto">
                        <div className="text-center mb-2"><Gamepad2 className="w-16 h-16 mx-auto text-sky-400 mb-2" /><h2 className="text-2xl font-black text-slate-700">é¸æ“‡æ¸¬é©—æ¨¡å¼</h2></div>
                        
                        {/* é¸æ“‡é¡Œ (å¤§äº‚é¬¥) */}
                        <button onClick={startChoiceQuiz} className="w-full max-w-xs bg-white border-4 border-slate-200 p-5 rounded-3xl hover:border-sky-400 group transition-all shadow-sm hover:shadow-md text-left relative overflow-hidden">
                            <div className="absolute right-[-20px] top-[-20px] bg-sky-100 w-24 h-24 rounded-full group-hover:scale-150 transition-transform duration-500"></div>
                            <div className="relative z-10 flex items-center gap-4"><div className="bg-sky-500 text-white p-3 rounded-2xl"><MousePointerClick className="w-6 h-6" /></div><div><h3 className="text-lg font-black text-slate-800">é¸æ“‡é¡Œå¤§æŒ‘æˆ°</h3><p className="text-xs text-slate-500 font-bold">10é¡Œ é™æ™‚æ¶ç­” (æ¯é¡Œ7ç§’)</p></div></div>
                        </button>

                        <div className="w-full max-w-xs space-y-3">
                            <div className="text-slate-400 text-xs font-black uppercase tracking-wider pl-2">Spelling Mode</div>
                            
                            {/* æ‹¼å­—ï¼šå–®å­—ç¯‡ */}
                            {hasWords && (
                                <button onClick={() => startSpellingQuiz('words')} className="w-full bg-white border-4 border-slate-200 p-4 rounded-3xl hover:border-violet-400 group transition-all shadow-sm hover:shadow-md text-left relative overflow-hidden">
                                    <div className="absolute right-[-20px] top-[-20px] bg-violet-100 w-20 h-20 rounded-full group-hover:scale-150 transition-transform duration-500"></div>
                                    <div className="relative z-10 flex items-center gap-3"><div className="bg-violet-500 text-white p-2.5 rounded-2xl"><Keyboard className="w-5 h-5" /></div><div><h3 className="text-lg font-black text-slate-800">æ‹¼å­—ï¼šå–®å­—ç¯‡</h3><p className="text-xs text-slate-500 font-bold">Vocabulary Only</p></div></div>
                                </button>
                            )}

                            {/* æ‹¼å­—ï¼šç‰‡èªç¯‡ */}
                            {hasPhrases && (
                                <button onClick={() => startSpellingQuiz('phrases')} className="w-full bg-white border-4 border-slate-200 p-4 rounded-3xl hover:border-pink-400 group transition-all shadow-sm hover:shadow-md text-left relative overflow-hidden">
                                    <div className="absolute right-[-20px] top-[-20px] bg-pink-100 w-20 h-20 rounded-full group-hover:scale-150 transition-transform duration-500"></div>
                                    <div className="relative z-10 flex items-center gap-3"><div className="bg-pink-500 text-white p-2.5 rounded-2xl"><Filter className="w-5 h-5" /></div><div><h3 className="text-lg font-black text-slate-800">æ‹¼å­—ï¼šç‰‡èªç¯‡</h3><p className="text-xs text-slate-500 font-bold">Phrases & Idioms</p></div></div>
                                </button>
                            )}
                        </div>
                    </div>
                );
            }

            if (status === 'result') {
                // è©•èªé‚è¼¯
                let feedbackTitle = "";
                let feedbackColor = "";
                if (score >= 900) {
                    feedbackTitle = "å²å®³ï¼";
                    feedbackColor = "text-yellow-500";
                } else if (score >= 800) {
                    feedbackTitle = "ä¸éŒ¯ï¼";
                    feedbackColor = "text-emerald-500";
                } else if (score >= 700) {
                    feedbackTitle = "é‚„å¯ä»¥";
                    feedbackColor = "text-sky-500";
                } else {
                    feedbackTitle = "åŠ æ²¹åŠ æ²¹å†æ¸¬ä¸€æ¬¡";
                    feedbackColor = "text-slate-500";
                }

                return (
                    <div className="flex flex-col h-full animate-in zoom-in pt-4 pb-20 overflow-y-auto">
                        <div className="flex flex-col items-center justify-center mb-6">
                            <Trophy className={`w-24 h-24 drop-shadow-xl animate-bounce mb-2 ${score >= 800 ? 'text-yellow-400' : 'text-slate-300'}`} />
                            <h2 className={`text-3xl font-black mb-1 ${feedbackColor}`}>{feedbackTitle}</h2>
                            <div className="text-6xl font-black text-slate-800 mb-2">{score} <span className="text-xl text-slate-400">åˆ†</span></div>
                        </div>

                        {/* æˆç¸¾ç¸½è¡¨ */}
                        <div className="bg-white rounded-2xl shadow-sm border-2 border-slate-200 overflow-hidden mx-1 mb-6">
                            <table className="w-full text-sm text-left">
                                <thead className="text-xs text-slate-500 uppercase bg-slate-100 border-b border-slate-200">
                                    <tr>
                                        <th className="px-3 py-3 w-10">#</th>
                                        <th className="px-3 py-3">é¡Œç›®</th>
                                        <th className="px-3 py-3 text-center">å¾—åˆ†</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {history.map((record, idx) => (
                                        <tr key={idx} className="border-b border-slate-100 last:border-0 hover:bg-slate-50">
                                            <td className="px-3 py-3 font-bold text-slate-400">{idx + 1}</td>
                                            <td className="px-3 py-3">
                                                <div className="font-bold text-slate-700">{record.q}</div>
                                                <div className="flex flex-col text-xs mt-1 gap-0.5">
                                                    <div className={record.isCorrect ? "text-emerald-600" : "text-rose-500 font-bold"}>
                                                        {record.isCorrect ? "â—" : "âœ•"} æ‚¨é¸: {record.user}
                                                    </div>
                                                    {!record.isCorrect && (
                                                        <div className="text-emerald-600 font-bold">
                                                            âœ“ æ­£è§£: {record.correct}
                                                        </div>
                                                    )}
                                                </div>
                                            </td>
                                            <td className="px-3 py-3 text-center font-black text-slate-700">
                                                {record.points > 0 ? <span className="text-emerald-500">+{record.points}</span> : <span className="text-slate-300">0</span>}
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>

                        <div className="flex justify-center pb-8">
                            <GameButton onClick={() => setStatus('menu')} color="green" className="w-64 text-xl py-4">å›åˆ°é¸å–®</GameButton>
                        </div>
                    </div>
                );
            }

            // æ‹¼å­—æ¨¡å¼ä½¿ç”¨éæ¿¾å¾Œçš„è³‡æ–™
            if (quizType === 'spelling') return <SpellingQuiz data={spellingData} onFinish={(s) => { setScore(s); setStatus('result'); }} />;

            // é¸æ“‡é¡Œæ¨¡å¼ (æ–°ç‰ˆé€šç”¨æ¸²æŸ“å™¨)
            const currentQ = quizData[currentQIndex];

            return (
                <div className="flex flex-col h-full max-w-md mx-auto">
                    <div className="mb-4 px-1 flex items-center justify-between"><div className="bg-white border-2 border-slate-200 px-3 py-1 rounded-full font-black text-slate-400 text-xs shadow-sm">STAGE {currentQIndex + 1} / {quizData.length}</div><div className="bg-yellow-100 border-2 border-yellow-300 px-3 py-1 rounded-full font-black text-yellow-700 text-xs shadow-sm">SCORE: {score}</div></div>
                    
                    {/* æ™‚é–“å€’æ•¸æ¢ */}
                    <div className="relative h-6 bg-slate-100 rounded-full overflow-hidden border-2 border-slate-300 mb-4 mx-1">
                        <div 
                            className={`h-full transition-all duration-1000 ease-linear ${timeLeft <= 3 ? 'bg-rose-500' : 'bg-sky-400'}`} 
                            style={{ width: `${(timeLeft / 7) * 100}%` }}
                        ></div>
                        <div className="absolute inset-0 flex items-center justify-center text-xs font-black text-slate-600 drop-shadow-sm">
                            <Timer className="w-3 h-3 mr-1" /> {timeLeft}s (æ»¿åˆ†éæ¸›)
                        </div>
                    </div>

                    <div className="bg-white border-4 border-b-8 border-violet-200 rounded-3xl p-8 mb-6 text-center relative overflow-hidden shadow-sm group">
                        <div className="absolute top-3 left-1/2 -translate-x-1/2 bg-violet-100 text-violet-600 px-3 py-1 rounded-lg text-xs font-black uppercase tracking-wider">Question</div>
                        <h2 className="font-black text-3xl text-slate-800 mt-6 leading-relaxed">{currentQ.questionText}</h2>
                        {currentQ.audio && <button onClick={() => speakText(currentQ.audio)} className="mt-4 p-2 bg-slate-100 rounded-full text-slate-400 hover:text-violet-500 hover:bg-violet-50 border-2 border-slate-200 hover:border-violet-200 transition-colors"><Volume2 className="w-6 h-6 mx-auto" /></button>}
                    </div>
                    <div className="grid grid-cols-1 gap-3 pb-8">
                        {currentQ.options.map((option, idx) => {
                            let color = "white";
                            // å¦‚æœå·²é¸æ“‡(åŒ…æ‹¬æ™‚é–“åˆ°)
                            if (selectedOption) {
                                if (option.isCorrect) color = "green"; // æ­£ç¢ºç­”æ¡ˆç¸½æ˜¯é¡¯ç¤ºç¶ è‰²
                                else if (selectedOption.id === option.id && !option.isCorrect) color = "red"; // å¦‚æœé¸éŒ¯äº†é¡¯ç¤ºç´…è‰²
                                else if (selectedOption.id === 'timeout' && !option.isCorrect) color = "white"; // æ™‚é–“åˆ°æ²’é¸çš„é¡¯ç¤ºç™½è‰²
                            }
                            
                            return (
                                <GameButton key={idx} disabled={!!selectedOption} onClick={() => handleOptionClick(option)} color={color} className={`justify-between py-4 text-left ${!selectedOption && "hover:bg-slate-50"}`}>
                                    <span className="text-lg">{option.text}</span>
                                    {selectedOption && option.isCorrect && <CheckCircle className="w-6 h-6 animate-bounce" />}
                                    {selectedOption && selectedOption.id === option.id && !option.isCorrect && <XCircle className="w-6 h-6 animate-pulse" />}
                                </GameButton>
                            );
                        })}
                    </div>
                    {selectedOption && <div className="fixed bottom-6 left-0 right-0 p-4 bg-transparent pointer-events-none flex justify-center z-20"><button onClick={nextQuestion} className="pointer-events-auto bg-slate-800 text-white px-8 py-4 rounded-2xl font-black text-xl shadow-2xl hover:bg-slate-900 hover:scale-105 transition-all flex items-center gap-2 animate-in slide-in-from-bottom-4 border-b-8 border-black">{currentQIndex < quizData.length - 1 ? "NEXT STAGE" : "FINISH"} <ChevronRight className="w-6 h-6" /></button></div>}
                </div>
            );
        };

        // --- å…ƒä»¶ 4: æ–‡æ³•æ¨¡å¼ (ä¿®æ­£ï¼š10é¡Œéš¨æ©Ÿï¼ŒéŸ³æ•ˆï¼Œçµç®—é é¢ï¼Œå³æ™‚å®Œæ•´è§£é‡‹ï¼Œé¡Œç›®é¡è‰²åé¥‹) ---
        const GrammarMode = ({ grammarData }) => {
            const [mode, setMode] = useState('notes'); // 'notes', 'quiz', 'scramble'
            const [currentQuizIndex, setCurrentQuizIndex] = useState(0);
            const [score, setScore] = useState(0);
            const [status, setStatus] = useState('menu'); // 'menu', 'playing', 'result'
            const [selectedOption, setSelectedOption] = useState(null);
            const [quizList, setQuizList] = useState([]);
            const [history, setHistory] = useState([]); // ç´€éŒ„ç­”é¡Œæ­·å²
            
            // æ–°åŠŸèƒ½ï¼šé¡Œåº«ç¸½è¡¨è¦–çª—ç‹€æ…‹
            const [showAllQuestions, setShowAllQuestions] = useState(false);
            const [previewTab, setPreviewTab] = useState('quiz'); // 'quiz', 'scramble'

            // è¼”åŠ©å‡½å¼ï¼šè™•ç†é¡Œåº«è³‡æ–™ï¼Œç¢ºä¿é¸é …è¢«æ‰“äº‚
            const prepareQuizData = (rawList) => {
                if (!rawList) return [];
                // éš¨æ©Ÿé¸å– 10 é¡Œ
                const selected = shuffleArray([...rawList]).slice(0, 10);
                return selected.map(item => ({
                    ...item,
                    options: shuffleArray([...item.options]) // å¼·åˆ¶æ‰“äº‚é¸é …
                }));
            };

            const handleShowMasterList = () => {
                const pwd = prompt("è«‹è¼¸å…¥ç®¡ç†å“¡å¯†ç¢¼ï¼š");
                if (pwd === "1999") {
                    setShowAllQuestions(true);
                } else if (pwd !== null) {
                    alert("å¯†ç¢¼éŒ¯èª¤ï¼");
                }
            };

            useEffect(() => {
                // åˆå§‹åŒ–
                setMode('notes');
                setStatus('menu');
            }, [grammarData]);

            const startQuiz = () => {
                if (grammarData?.quiz) { 
                    setQuizList(prepareQuizData(grammarData.quiz));
                    setCurrentQuizIndex(0);
                    setScore(0);
                    setHistory([]);
                    setSelectedOption(null);
                    setStatus('playing');
                }
            };

            const handleOptionClick = (option, correctAns, qItem) => {
                if (selectedOption) return;
                setSelectedOption(option);
                
                const isCorrect = option === correctAns;
                if (isCorrect) { 
                    setScore(prev => prev + 10); 
                    playSound('correct');
                } else { 
                    playSound('wrong'); 
                }

                // è¨˜éŒ„æ­·å²
                setHistory(prev => [...prev, {
                    question: qItem.q,
                    userAns: option,
                    correctAns: correctAns,
                    isCorrect: isCorrect,
                    hint: qItem.hint
                }]);
            };

            const nextQuestion = () => {
                if (currentQuizIndex < quizList.length - 1) { 
                    setCurrentQuizIndex(prev => prev + 1); 
                    setSelectedOption(null); 
                } else { 
                    setStatus('result'); 
                }
            };

            const restartQuiz = () => {
                startQuiz();
            };

            if (!grammarData || !grammarData.notes) return <div>Grammar content coming soon!</div>;

            return (
                <div className="flex flex-col h-full animate-in fade-in relative">
                    {/* ä¸èµ·çœ¼çš„è§’è½æŒ‰éˆ•ï¼šé¡Œåº«ç¸½è¡¨ */}
                    <button 
                        onClick={handleShowMasterList}
                        className="absolute -top-1 right-0 p-2 text-slate-300 hover:text-indigo-500 transition-colors z-10"
                        title="æŸ¥çœ‹æ‰€æœ‰é¡Œåº« (éœ€å¯†ç¢¼)"
                    >
                        <FileText className="w-5 h-5" />
                    </button>

                    <div className="flex justify-center mb-6 gap-2">
                        <GameButton onClick={() => setMode('notes')} active={mode === 'notes'} color="white" className="text-sm px-3"><PenTool className="w-4 h-4" /> ç­†è¨˜</GameButton>
                        <GameButton onClick={() => { setMode('quiz'); startQuiz(); }} active={mode === 'quiz'} color="white" className="text-sm px-3"><CheckCircle className="w-4 h-4" /> æŒ‘æˆ°</GameButton>
                        <GameButton onClick={() => setMode('scramble')} active={mode === 'scramble'} color="white" className="text-sm px-3"><Puzzle className="w-4 h-4" /> å¥å‹é‡çµ„</GameButton>
                    </div>

                    {mode === 'notes' && (
                        <div className="flex-1 overflow-y-auto pb-20 space-y-4">
                            {/* æ–°å¢ Tip å€å¡Š */}
                            {grammarData.tips && (
                                <div className="bg-yellow-50 border-4 border-yellow-200 rounded-3xl p-5 mb-4 shadow-sm animate-in slide-in-from-top-2">
                                    <h3 className="text-xl font-black text-yellow-700 mb-3 flex items-center gap-2">
                                        <Lightbulb className="w-6 h-6 fill-yellow-400 text-yellow-600" /> 
                                        ä½œç­”å°æŠ€å·§ (Exam Tips)
                                    </h3>
                                    <div className="grid grid-cols-1 gap-2">
                                        {grammarData.tips.map((tip, i) => (
                                            <div key={i} className="bg-white p-3 rounded-xl border-l-4 border-yellow-400 shadow-sm flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-3">
                                                <span className="font-black text-slate-700 bg-yellow-100 px-2 py-0.5 rounded text-sm whitespace-nowrap">{tip.label}</span>
                                                <span className="text-slate-600 text-sm font-bold">{tip.text}</span>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {grammarData.notes.map((note, idx) => (
                                <div key={idx} className="bg-white border-4 border-slate-200 rounded-3xl p-6 shadow-sm hover:border-indigo-300 transition-colors">
                                    <h3 className="text-xl font-black text-indigo-600 mb-2 flex items-center gap-2"><div className="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-500 text-sm">{idx+1}</div>{note.title}</h3>
                                    <div className="bg-slate-100 p-3 rounded-xl font-bold text-slate-700 mb-3 border-l-4 border-slate-400 whitespace-pre-line">{note.rule}</div>
                                    <p className="text-slate-500 text-sm mb-4 font-bold whitespace-pre-line">{note.desc}</p>
                                    <div className="space-y-2">{note.examples.map((ex, i) => (<div key={i} className="flex gap-2 text-slate-600 text-sm font-medium"><span className="text-green-500 font-bold">âœ“</span> {ex}</div>))}</div>
                                </div>
                            ))}
                        </div>
                    )}
                    
                    {mode === 'scramble' && <ScrambleMode data={grammarData.scramble || []} titleOverride="GRAMMAR SCRAMBLE" />}
                    
                    {mode === 'quiz' && (
                        status === 'result' ? (
                            <div className="flex flex-col h-full animate-in zoom-in pb-20 overflow-y-auto">
                                <div className="flex flex-col items-center justify-center mb-6 pt-4">
                                    <Trophy className="w-20 h-20 text-yellow-400 drop-shadow-lg mb-2" />
                                    <h2 className="text-3xl font-black text-slate-800 mb-1">æ¸¬é©—å®Œæˆï¼</h2>
                                    <div className="text-5xl font-black text-indigo-600 mb-4">{score} <span className="text-xl text-slate-400">åˆ†</span></div>
                                    <GameButton onClick={restartQuiz} color="green" className="w-48 text-lg">å†æ¸¬é©—ä¸€æ¬¡</GameButton>
                                </div>
                                
                                <div className="space-y-4 px-2">
                                    {history.map((item, idx) => (
                                        <div key={idx} className={`bg-white border-l-8 rounded-xl p-4 shadow-sm ${item.isCorrect ? 'border-emerald-400' : 'border-rose-400'}`}>
                                            <div className="flex items-start gap-3 mb-2">
                                                <div className={`w-8 h-8 rounded-full flex items-center justify-center text-white font-bold shrink-0 ${item.isCorrect ? 'bg-emerald-500' : 'bg-rose-500'}`}>
                                                    {item.isCorrect ? <CheckCircle size={18} /> : <XCircle size={18} />}
                                                </div>
                                                <div className="flex-1">
                                                    {/* çµæœåˆ—è¡¨é¡Œç›®ä¸­ä¹Ÿå¡«å…¥æ­£ç¢ºç­”æ¡ˆ (ä¿®æ­£ç‰ˆï¼šç›´æ¥é¡¯ç¤ºè©²é¡Œæ­£ç¢ºç­”æ¡ˆï¼Œä¸¦ä¾å°éŒ¯è®Šè‰²) */}
                                                    <h4 className="font-bold text-slate-800 text-lg leading-relaxed">
                                                        {item.question.split('______').map((part, i, arr) => (
                                                            <React.Fragment key={i}>
                                                                {part}
                                                                {i < arr.length - 1 && (
                                                                    <span className={`inline-block border-b-4 mx-1 font-black px-2 rounded ${item.isCorrect ? 'text-emerald-600 border-emerald-400 bg-emerald-50' : 'text-rose-600 border-rose-400 bg-rose-50'}`}>
                                                                        {item.correctAns}
                                                                    </span>
                                                                )}
                                                            </React.Fragment>
                                                        ))}
                                                    </h4>
                                                    <div className="flex flex-wrap gap-2 mt-2 text-sm">
                                                        <span className={`px-2 py-1 rounded font-bold ${item.isCorrect ? 'bg-emerald-100 text-emerald-700' : 'bg-rose-100 text-rose-700'}`}>
                                                            ä½ çš„ç­”æ¡ˆ: {item.userAns}
                                                        </span>
                                                        {!item.isCorrect && (
                                                            <span className="px-2 py-1 rounded font-bold bg-emerald-100 text-emerald-700">
                                                                æ­£è§£: {item.correctAns}
                                                            </span>
                                                        )}
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            {/* é¡¯çœ¼çš„è§£é‡‹å¡ç‰‡ */}
                                            <div className="mt-3 bg-indigo-50 border-2 border-indigo-100 rounded-lg p-3 flex items-start gap-2">
                                                <Info className="w-5 h-5 text-indigo-500 shrink-0 mt-0.5" />
                                                <p className="text-indigo-700 text-sm font-bold">{item.hint}</p>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        ) : (
                            <div className="flex flex-col h-full max-w-md mx-auto relative pt-4">
                                {quizList.length > 0 && (
                                    <>
                                        <div className="mb-4 flex justify-between items-center px-1">
                                            <span className="text-xs font-black text-slate-400 uppercase tracking-wider">Question {currentQuizIndex + 1} / {quizList.length}</span>
                                            <span className="text-xs font-black text-yellow-600 bg-yellow-100 px-2 py-1 rounded-lg">SCORE: {score}</span>
                                        </div>
                                        <div className="bg-white border-4 border-b-8 border-indigo-200 rounded-3xl p-6 mb-6 min-h-[140px] flex items-center justify-center text-center shadow-sm relative">
                                            <h3 className="text-xl font-black text-slate-700 leading-relaxed">
                                                {quizList[currentQuizIndex].q.split('______').map((part, i, arr) => (
                                                    <React.Fragment key={i}>
                                                        {part}
                                                        {i < arr.length - 1 && (
                                                            selectedOption ? (
                                                                // å·²ä½œç­”ç‹€æ…‹ï¼šç›´æ¥å¡«å…¥æ­£ç¢ºç­”æ¡ˆï¼Œç”¨é¡è‰²å€åˆ†å°éŒ¯
                                                                <span className={`inline-block min-w-[60px] border-b-4 mx-1 font-black ${selectedOption === quizList[currentQuizIndex].ans ? 'text-emerald-500 border-emerald-400' : 'text-rose-500 border-rose-400'}`}>
                                                                    {quizList[currentQuizIndex].ans}
                                                                </span>
                                                            ) : (
                                                                // æœªä½œç­”ç‹€æ…‹ï¼šé¡¯ç¤ºå•è™Ÿ
                                                                <span className="inline-block min-w-[60px] border-b-4 mx-1 font-bold text-indigo-600 border-indigo-400">?</span>
                                                            )
                                                        )}
                                                    </React.Fragment>
                                                ))}
                                            </h3>
                                        </div>
                                        <div className="grid grid-cols-1 gap-3">
                                            {quizList[currentQuizIndex].options.map((opt, idx) => {
                                                const isCorrect = opt === quizList[currentQuizIndex].ans;
                                                let btnColor = "white";
                                                if (selectedOption) {
                                                    if (isCorrect) btnColor = "green";
                                                    else if (selectedOption === opt) btnColor = "red";
                                                }
                                                return (
                                                    <GameButton key={idx} onClick={() => handleOptionClick(opt, quizList[currentQuizIndex].ans, quizList[currentQuizIndex])} disabled={!!selectedOption} color={btnColor} className="py-3 text-lg justify-between">
                                                        {opt}
                                                        {selectedOption && isCorrect && <CheckCircle className="w-5 h-5" />}
                                                        {selectedOption === opt && !isCorrect && <XCircle className="w-5 h-5" />}
                                                    </GameButton>
                                                )
                                            })}
                                        </div>
                                        
                                        {/* å³æ™‚å®Œæ•´è§£é‡‹å€å¡Š (ä¸è«–å°éŒ¯éƒ½é¡¯ç¤º) */}
                                        {selectedOption && (
                                            <div className="mt-4 animate-in fade-in slide-in-from-bottom-2">
                                                <div className={`p-4 rounded-xl border-l-4 mb-4 shadow-sm ${selectedOption === quizList[currentQuizIndex].ans ? 'bg-emerald-50 border-emerald-500 text-emerald-900' : 'bg-rose-50 border-rose-500 text-rose-900'}`}>
                                                    <div className="flex items-center gap-2 mb-2 font-black text-lg">
                                                        {selectedOption === quizList[currentQuizIndex].ans ? 
                                                            <><CheckCircle className="w-6 h-6" /> ç­”å°äº†ï¼</> : 
                                                            <><XCircle className="w-6 h-6" /> ç­”éŒ¯äº†ï¼</>
                                                        }
                                                    </div>
                                                    {!selectedOption === quizList[currentQuizIndex].ans && (
                                                        <div className="mb-2 text-sm font-bold">æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š<span className="text-lg mx-1 underline">{quizList[currentQuizIndex].ans}</span></div>
                                                    )}
                                                    {/* å®Œæ•´è§£é‡‹ (ç§»é™¤ç´«è‰²åœ“åœˆï¼Œæ”¹ç‚ºç´”æ–‡å­—æ¨™ç±¤) */}
                                                    <div className="bg-white/80 p-3 rounded-lg border border-black/10 shadow-inner">
                                                        <p className="text-sm text-slate-500 font-bold mb-1">è§£é‡‹ï¼š</p>
                                                        <p className="text-base font-bold text-slate-800">{quizList[currentQuizIndex].hint}</p>
                                                    </div>
                                                </div>
                                                <div className="flex justify-center">
                                                    <GameButton onClick={nextQuestion} color="blue" className="w-full text-lg py-3 shadow-lg border-b-4 border-blue-600 active:border-b-0">
                                                        {currentQuizIndex < quizList.length - 1 ? "ä¸‹ä¸€é¡Œ" : "çœ‹æˆç¸¾"} <ChevronRight className="w-5 h-5" />
                                                    </GameButton>
                                                </div>
                                            </div>
                                        )}
                                    </>
                                )}
                            </div>
                        )
                    )}

                    {/* é¡Œåº«ç¸½è¡¨ Modal */}
                    {showAllQuestions && (
                        <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-in fade-in">
                            <div className="bg-white rounded-3xl w-full max-w-lg h-[80vh] flex flex-col shadow-2xl animate-in zoom-in border-4 border-slate-200">
                                <div className="p-4 border-b-2 border-slate-100 flex justify-between items-center bg-slate-50 rounded-t-3xl">
                                    <h3 className="text-xl font-black text-slate-700 flex items-center gap-2"><Library className="w-6 h-6 text-indigo-500" /> é¡Œåº«ç¸½è¦½</h3>
                                    <button onClick={() => setShowAllQuestions(false)} className="p-2 hover:bg-slate-200 rounded-full transition-colors"><X className="w-6 h-6 text-slate-500" /></button>
                                </div>
                                
                                <div className="flex p-2 gap-2 bg-slate-50 border-b border-slate-200">
                                    <button onClick={() => setPreviewTab('quiz')} className={`flex-1 py-2 rounded-xl font-bold text-sm transition-all ${previewTab === 'quiz' ? 'bg-white shadow text-indigo-600 border border-slate-200' : 'text-slate-400 hover:text-slate-600'}`}>æ–‡æ³•é¸æ“‡é¡Œ ({grammarData.quiz.length})</button>
                                    <button onClick={() => setPreviewTab('scramble')} className={`flex-1 py-2 rounded-xl font-bold text-sm transition-all ${previewTab === 'scramble' ? 'bg-white shadow text-orange-600 border border-slate-200' : 'text-slate-400 hover:text-slate-600'}`}>å¥å‹é‡çµ„ ({grammarData.scramble.length})</button>
                                </div>

                                <div className="flex-1 overflow-y-auto p-4 bg-slate-50/50">
                                    {previewTab === 'quiz' ? (
                                        <div className="space-y-3">
                                            {grammarData.quiz.map((item, idx) => (
                                                <div key={idx} className="bg-white p-4 rounded-xl border-2 border-slate-100 shadow-sm">
                                                    <div className="flex gap-3">
                                                        <div className="font-black text-slate-300 text-sm pt-1">{String(idx + 1).padStart(2, '0')}</div>
                                                        <div className="flex-1">
                                                            <div className="font-bold text-slate-700 text-base mb-2">
                                                                {item.q.replace('______', `(${item.ans})`)}
                                                            </div>
                                                            {/* æ–°å¢ï¼šé¡¯ç¤ºæ‰€æœ‰é¸é … */}
                                                            <div className="flex flex-wrap gap-2 mb-2">
                                                                {item.options.map((opt, optIdx) => (
                                                                    <span 
                                                                        key={optIdx} 
                                                                        className={`text-xs px-2 py-1 rounded border-2 ${opt === item.ans ? 'bg-emerald-100 border-emerald-200 text-emerald-700 font-bold' : 'bg-white border-slate-200 text-slate-500'}`}
                                                                    >
                                                                        {opt}
                                                                    </span>
                                                                ))}
                                                            </div>
                                                            <div className="text-xs font-medium text-slate-400 bg-slate-100 px-2 py-1 rounded inline-block">
                                                                ğŸ’¡ {item.hint}
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    ) : (
                                        <div className="space-y-3">
                                            {grammarData.scramble.map((item, idx) => (
                                                <div key={idx} className="bg-white p-4 rounded-xl border-2 border-slate-100 shadow-sm">
                                                    <div className="flex gap-3">
                                                        <div className="font-black text-slate-300 text-sm pt-1">{String(idx + 1).padStart(2, '0')}</div>
                                                        <div className="flex-1">
                                                            <div className="font-bold text-indigo-600 text-base mb-1">{item.sentence}</div>
                                                            <div className="text-sm font-bold text-slate-500">{item.sentence_ch}</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // --- Main App Container ---
        function Unit56App() {
            const [activeTab, setActiveTab] = useState('study');
            const [currentUnit, setCurrentUnit] = useState('unit1'); 

            const unitTitle = UNITS_DATA[currentUnit].title;
            const unitData = UNITS_DATA[currentUnit].vocab;
            const unitGrammar = UNITS_DATA[currentUnit].grammar;

            useEffect(() => { document.body.classList.add('loaded'); }, []);

            return (
                <div className="min-h-screen font-sans text-slate-800 flex flex-col bg-sky-50 bg-[radial-gradient(#e5e7eb_1px,transparent_1px)] [background-size:16px_16px]">
                <div className="bg-white/90 backdrop-blur-sm sticky top-0 z-50 border-b-4 border-slate-200">
                    <div className="max-w-md mx-auto px-4 py-3">
                    <div className="flex justify-between items-center mb-3 bg-slate-100 p-2 rounded-2xl border-2 border-slate-200 overflow-x-auto">
                        <div className="flex items-center gap-2 font-black text-slate-600 text-lg tracking-tight ml-2 mr-2 whitespace-nowrap"><Map className="w-6 h-6 text-sky-500" /><span>MAP</span></div>
                        <div className="flex gap-2">
                            {['unit1', 'unit2'].map(uKey => (
                            <button key={uKey} onClick={() => setCurrentUnit(uKey)} className={`px-3 py-1 text-xs sm:text-sm font-black rounded-xl transition-all border-b-4 active:border-b-0 active:translate-y-1 whitespace-nowrap ${currentUnit === uKey ? 'bg-sky-500 border-sky-700 text-white shadow-sky-200' : 'bg-white border-slate-300 text-slate-400 hover:bg-slate-50'}`}>{UNITS_DATA[uKey].title}</button>
                            ))}
                        </div>
                    </div>
                    <div className="grid grid-cols-4 gap-2">
                        <GameButton onClick={() => setActiveTab('study')} active={activeTab === 'study'} color={activeTab === 'study' ? 'active' : 'white'} className="text-xs py-3 px-1"><Layers className="w-3 h-3 md:w-4 md:h-4" /> å­¸ç¿’</GameButton>
                        <GameButton onClick={() => setActiveTab('quiz')} active={activeTab === 'quiz'} color={activeTab === 'quiz' ? 'active' : 'white'} className="text-xs py-3 px-1"><CheckCircle className="w-3 h-3 md:w-4 md:h-4" /> æ¸¬é©—</GameButton>
                        <GameButton onClick={() => setActiveTab('sentences')} active={activeTab === 'sentences'} color={activeTab === 'sentences' ? 'active' : 'white'} className="text-xs py-3 px-1"><Puzzle className="w-3 h-3 md:w-4 md:h-4" /> é‡çµ„</GameButton>
                        <GameButton onClick={() => setActiveTab('grammar')} active={activeTab === 'grammar'} color={activeTab === 'grammar' ? 'active' : 'white'} className="text-xs py-3 px-1"><GraduationCap className="w-3 h-3 md:w-4 md:h-4" /> æ–‡æ³•</GameButton>
                    </div>
                    </div>
                </div>
                <div className="flex-1 max-w-md mx-auto w-full p-4 pt-6">
                    <div className="mb-6 text-center"><span className="inline-flex items-center gap-2 bg-slate-800 text-white text-xs font-black px-4 py-1.5 rounded-full border-2 border-slate-600 shadow-md"><Map className="w-3 h-3 text-yellow-400" />ç›®å‰é—œå¡ï¼š{unitTitle}</span></div>
                    {activeTab === 'study' && <StudyMode data={unitData} />}
                    {activeTab === 'quiz' && <QuizMode data={unitData} grammarData={unitGrammar} />}
                    {activeTab === 'sentences' && <ScrambleMode data={unitData} />}
                    {activeTab === 'grammar' && <GrammarMode grammarData={unitGrammar} />}
                </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Unit56App />);
    </script>
</body>
</html>
